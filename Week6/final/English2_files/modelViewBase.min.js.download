/*!
 * Copyright (c) 1999, 2024, Oracle and/or its affiliates.
 */
apex.model={},function(e,t,i,n,s,r,l){"use strict";const a="table",d="tree",o="record",h="Malformed response",c="refresh",u="addData",f="revert",g="refreshRecords",_="delete",p="clearChanges",y="set",I="destroy",m="one",v="none";let R={},w=[],x=100,b=10;const F=new Set(["genIdPrefix","pageItemsToSubmit","fetchData","saveData","regionData","requestOptions","parentRecordId","editable","pageSize","callServer","visibilityFilter","visibilityFilterContext","trackChanges","onlyMarkForDelete"]),M=n.hasOwnProperty,D=l.extend,C=Array.isArray,A=l.isPlainObject,K=e=>"function"==typeof e,S=l.Deferred,T=n.equalValue,k=r.toNumber;function O(e){return e.replace(/#/g,"").split(/\s*,\s*/)}function E(e){return"object"==typeof e&&M(e,"v")}function q(e){if("string"==typeof e)return[e,null];if(C(e)&&2===e.length&&"string"==typeof e[0]&&(null===e[1]||"string"==typeof e[1]))return e;throw new Error("Invalid model id")}const V=new Map;function P(e){let t=V.get(e);return t||(t=1e3),V.set(e,t+1),t}function N(e){if(C(e)){let t=[];for(let i=0;i<e.length;i++)t.push(N(e[i]));return t}return A(e)?D(!0,{},e):e}function j(e,t,n){let s=e._listeners;for(let r=0;r<s.length;r++)try{s[r].onChange(t,n)}catch(e){i.error("Error in model listener.",e)}}function z(e,t,i,n,s,r){e?t.call(e,i,n,s,r):t(i,n,s)}function U(e){e.allowedOperations&&(e.canEdit=!!e.allowedOperations.update,e.canDelete=!!e.allowedOperations.delete)}function W(e){return"string"==typeof e?e:C(e)?1===e.length?""+e[0]:JSON.stringify(e):e.toString()}function $(e,t){let i=[],s=[];function r(e){let t,n=e._listeners;for(let e=0;e<n.length;e++)t=n[e].progressView,t&&t[0]&&t[0].offsetWidth&&t[0].offsetHeight&&(i.push(t),s.push(n[e].progressOptions||null))}if(r(e),t)for(let e=0;e<t.length;e++)r(t[e]);return 0===i.length?null:e._options.makeLoadingIndicator?e._options.makeLoadingIndicator(i,s):function(){let e,t=l();for(let r=0;r<i.length;r++)e=n.showSpinner(i[r],s[r]),t=t.add(e);return function(){t.remove()}}}function B(e,t){return D({},e.requestOptions,{loadingIndicator:$(t)})}function H(e,t,i,n){let s,r=e;return n&&(r+=" Server status: "+n),s=new Error(r),t&&t.status>=0&&(s.status=t.status),s}function L(e,t){var i,n;for(i in delete e.error,delete e.warning,delete e.message,e.fields)M(e.fields,i)&&(n=e.fields[i],t||(delete n.changed,delete n.stale),delete n.error,delete n.warning,delete n.message)}function G(e,t,i){let n=-1,s=-1;return t-1>=0&&(n=parseFloat(e[t-1][i])),t<e.length&&(s=parseFloat(e[t][i])),[n,s]}function Y(e,t,i,n,s,r){let l;return-1===t&&(t=0),r&&r>t&&(-1===i||r<i)?r:(-1===i&&(i=t+e*n),l=i-t,t+l/(n+1)*s)}const J=e=>new Error(`Model has invalid shape for the ${e} method`),X=e=>new Error(`Wrong data type for ${e} aggregate`),Q=()=>new Error("Model must have identityField defined"),Z=(e,t)=>new Error(`Field '${e}' depends on unknown field/item '${t}'`),ee=(e,t)=>new Error(e+" field not found: "+t);function te(e,t,i){var n,s,r,l;for(n in t)M(t,n)&&((s=t[n]).volatile||s.virtual||"string"==typeof(l=e[r=i?s.index:n])&&(e[r]=l.replace(/\r\n/g,"\n")))}function ie(e,t,i,n,r){let l=e._options,a=t.record,d=e._getIdentity(a),o=[];!function t(i,n,s){for(let r=0;r<i.length;r++){let a,d=i[r],o=l.fields[d];o&&!n[d]&&(o.dependsOn&&t(o.dependsOn,n,s),n[d]||!o.calcValue&&!o.dependsOn||(s.push(d),n[d]=1,a=e._dependentFields[d],a&&t(a,n,s)))}}(i,r||{},o);for(let i=0;i<o.length;i++){let r,h,c,u,f,g,_,p,I=o[i],m=l.fields[I];if(m.calcValue){g=[];for(let t=0;t<m.dependsOn.length;t++)c=m.dependsOn[t],":"===c.substr(0,1)?_=s(c.substr(1)).getValue():(u=l.fields[c],_=e.getValue(a,c),"NUMBER"===m.dataType&&(_=k(_,u?u.formatMask:null))),g.push(_);if(p=m.calcValue(g,e,a),r=e.getFieldKey(I),t.fields&&t.fields[I]&&t.fields[I].ck)throw new Error("Set calculated value not allowed for field");h=a[r],T(h,p)||(a[r]=p,t.fields||(t.fields={}),f=t.fields[I],f||(f={},t.fields[I]=f),l.trackChanges&&(f.changed=!0),n&&j(e,y,{oldValue:h,oldIdentity:null,recordId:d,record:a,field:I}),e._checkAggregates(I))}else m.cellTemplate?(r=e.getFieldKey(I),h=a[r],n&&j(e,y,{oldValue:h,oldIdentity:null,recordId:d,record:a,field:I})):(f=t.fields[I],f||(f={},t.fields[I]=f),f.stale=!0,n&&e.metadataChanged(d,I,"stale"))}}function ne(e,t){let i={},n=t.record,s=[];for(let t=0;t<e._calculatedFields.length;t++){let r=e._calculatedFields[t];null==n[e.getFieldKey(r)]?s.push(r):i[r]=1}s.length>0&&ie(e,t,s,!1,i)}const se={SUM:{name:"SUM",init:function(e){if(e.dataType&&"NUMBER"!==e.dataType)throw X("SUM");e.total=0,e.grandTotal=0},add:function(e,t){t=k(t,e.formatMask),isNaN(t)||(e.total+=t,e.grandTotal+=t)},get:function(e,t){const i=t?e.total:e.grandTotal;return t&&(e.total=0),i}},AVG:{name:"AVG",init:function(e){if(e.dataType&&"NUMBER"!==e.dataType)throw X("AVG");e.total=0,e.grandTotal=0,e.count=0,e.totalCount=0},add:function(e,t){t=k(t,e.formatMask),isNaN(t)||(e.total+=t,e.grandTotal+=t,e.count+=1,e.totalCount+=1)},get:function(e,t){const i=t?e.total/e.count:e.grandTotal/e.totalCount;return t&&(e.total=0,e.count=0),i}},MAX:{name:"MAX",init:function(e){e.max=null,e.overallMax=null},add:function(e,t){"NUMBER"===e.dataType?t=k(t,e.formatMask):t.d&&(t=t.d),null===t||""===t.toString().trim()||isNaN(t)||((null===e.max||t>e.max)&&(e.max=t),(null===e.overallMax||t>e.overallMax)&&(e.overallMax=t))},get:function(e,t){const i=t?e.max:e.overallMax;return t&&(e.max=null),i}},MIN:{name:"MIN",init:function(e){e.min=null,e.overallMin=null},add:function(e,t){"NUMBER"===e.dataType?t=k(t,e.formatMask):t.d&&(t=t.d),null===t||""===t.toString().trim()||isNaN(t)||((null===e.min||t<e.min)&&(e.min=t),(null===e.overallMin||t<e.overallMin)&&(e.overallMin=t))},get:function(e,t){const i=t?e.min:e.overallMin;return t&&(e.min=null),i}},MEDIAN:{name:"MEDIAN",init:function(e){e.values=[],e.allValues=[]},add:function(e,t){t=k(t,e.formatMask),isNaN(t)||(e.values.push(t),e.allValues.push(t))},get:function(e,t){const i=t?e.values:e.allValues,n=i.length;let s;return i.sort((function(e,t){return e-t})),s=n%2==0?(i[n/2]+i[n/2-1])/2:i[(n-1)/2],t&&(e.values=[]),s}},COUNT:{name:"COUNT",init:function(e){e.count=0,e.totalCount=0},add:function(e,t){t.v&&(t=t.v),null!==t&&""!==t.toString().trim()&&(e.count+=1,e.totalCount+=1)},get:function(e,t){const i=t?e.count:e.totalCount;return t&&(e.count=0),i}},COUNT_DISTINCT:{name:"COUNT_DISTINCT",init:function(e){e.count=0,e.totalCount=0,e.distinctValues={}},add:function(e,t){t.v&&(t=t.v),null!==t&&""!==t.toString().trim()&&(e.distinctValues[t]||(e.count+=1,e.totalCount+=1),e.distinctValues[t]=1)},get:function(e,t){var i=t?e.count:e.totalCount;return t&&(e.count=0),i}}},re={modelId:function(){return null===this.instance?this.name:[this.name,this.instance]},_addToFetchRequest:function(e,t){let n,s,r=this,l=this._options;if(l.shape===a){let e,i=null,s=(c=t,u=l.pageSize,Math.floor(c/u)*u);if(t=function(e){let t,i=r._data;for(t=e;t<i.length&&void 0!==i[t];t++);return t}(s),this._haveAllData&&t>=this._data.length||this._masterRecordIsInserted||this._masterRecordIsDeleted)return!1;if(l.paginationType===v&&0!==t)return!1;e=this._getServerOffset(t),l.paginationType!==v&&(i=s+l.pageSize-e,i<l.pageSize&&void 0===this._data[s+l.pageSize]&&(i+=l.pageSize)),n={version:l.version,firstRow:e+1,maxRows:i}}else{if(l.shape===o&&this._haveAllData)return!1;n={version:l.version}}var c,u;if(this._requestsInProgress.fetch)return null;if(s=D({},l.regionData,{id:l.regionId,ajaxIdentifier:l.ajaxIdentifier,fetchData:D({},l.fetchData,n)}),e.regions||(e.regions=[]),e.regions.push(s),l.pageItemsToSubmit){let t,i=e.pageItems;i?C(i)||(i=O(i),e.pageItems=i):(i=[],e.pageItems=i),t=l.pageItemsToSubmit,C(t)||(t=O(t));for(let e=0;e<t.length;e++)i.includes(t[e])||i.push(t[e])}return this._addParentItems(s),this._requestsInProgress.fetch=!0,function(e){e.done((function(e){let n=!1;if(delete r._requestsInProgress.fetch,!r._destroyed){if(e.regions)for(let i=0;i<e.regions.length;i++){let s=e.regions[i];if(s.id===l.regionId){let e=null,i=null,h=null,c=null,u=null;s=s.fetchedData,l.shape===a?(e=s.values,i=s.totalRows,h=s.firstRow-1,c=s.moreData,u=s.dataOverflow):l.shape===d?e=s.root:l.shape===o&&(e=s.value),(e||l.shape===o)&&(r._addData(t,h,e,i,c,u),n=!0)}}if(!n){let t=H(h);i.error("Failed to fetch data.",t),e.error=t}}})).fail((function(){delete r._requestsInProgress.fetch}))}},fetch:function(e,t,i){let n,s,r,l,a=this._options,d=S(),o={};return"number"!=typeof e&&(i=t,t=e,e=0),s=this._addToFetchRequest(o,e),s?(l=D({},a.requestOptions),i?delete l.loadingIndicator:l.loadingIndicator=$(this),n=this._callServer(o,l),s(n),n.done((e=>{e.error?d.reject(e.error):e.errors?d.reject(e.errors):d.resolve()})).fail(((e,t,i)=>{d.reject(H("Error fetching data.",e,0,i))})),r=d.promise(),r.always((e=>{this._destroyed||(t&&t(e),this._drainWaiters(e))})),r):s},fetchAll:function(e,t=!0){const i=this,s=this._options,r=s.pageSize,d="m"+this.modelId();let o,h,c,u=0;if(s.shape!==a)throw J("fetchAll");if(r<1e3&&(s.pageSize=1e3),o=s.pageSize,!t){const e=l('<span class="u-Processing u-Processing--inline"><span class="u-Processing-spinner"></span></span>');h=$(this),h&&n.delayLinger.start(d,(function(){c=h(e)}))}for(;this._data[u];)u+=1;!function t(){const l=i.fetch(u,(function(n){n?e({error:n}):(e({offset:u,total:i.getTotalRecords(),done:!1}),u+=o,t())}),!0);null===l?setTimeout((function(){t()}),500):!1===l&&(s.pageSize=r,h&&n.delayLinger.finish(d,(function(){K(c)?c():c.remove()})),e({offset:u,total:i.getTotalRecords(),done:!0}))}()},fetchRecords:function(e,t){let n,s,r,l,a,d=this._options,c=[],u=S();if(d.shape===o)throw J("fetchRecords");if(void 0===this._identityKeys)throw Q();for(let t=0;t<e.length;t++){let i=this._getIdentity(e[t]),n=this.getRecordMetadata(i);n&&!n.inserted&&c.push({recordId:i,pk:this._getPrimaryKey(e[t])})}return 0===c.length?null:(a=D({},d.regionData,{id:d.regionId,ajaxIdentifier:d.ajaxIdentifier,fetchData:D({},d.fetchData,{version:d.version,primaryKeys:c})}),r={regions:[a]},d.pageItemsToSubmit&&(r.pageItems=d.pageItemsToSubmit),this._addParentItems(r.regions[0]),l=B(d,this),n=this._callServer(r,l),n.done((e=>{let t;if(!this._destroyed){if(e.regions&&e.regions.length>0){let i=e.regions[0];i.fetchedData&&i.id===d.regionId&&(t=i.fetchedData.values)}if(t)this._updateData(t),u.resolve();else{let e=H(h);i.error("Failed update data.",e),u.reject(e)}}})).fail((function(e,t,i){u.reject(H("Error fetching records.",e,0,i))})),s=u.promise(),t&&s.always(t),s)},save:function(e){let t,i,n,s=B(this._options,this),r=S(),l={};return i=this.addChangesToSaveRequest(l),i?(t=this._callServer(l,s),i(t),t.done((function(e){e.errors?r.reject(e.errors):e.error?r.reject(e.error):r.resolve(null,e)})).fail((function(e,t,i){r.reject(H("Error saving data.",e,0,i))})),n=r.promise(),e&&n.always(e),n):null},saveInProgress:function(){return!!this._requestsInProgress.save},addChangesToSaveRequest:function(e){let t,s,r,l,a,d,o,c=this,u=this._options,f=this._metaKey,g=[],_=[],p={},y=[],I=0;function m(){delete c._requestsInProgress.save,c._changes=c._pendingChanges.concat(c._changes)}function v(e){let t,i,n,s,r,l,a=e.record;r=e.inserted&&!e.originalId,t=u.recordIsArray?[]:{};for(let s=0;s<_.length;s++)n=_[s],i=a[n],null!==i&&E(i)&&(i=i.v),l=p[n],e.fields&&e.fields[l]&&e.fields[l].disabled&&(i=""),!r||!c.isIdentityField(l)||e.original&&i!==e.original[n]||(i=""),"string"==typeof i&&(i=i.replace(/\n/g,"\r\n")),u.recordIsArray?t.push(N(i)):t[n]=N(i);s=null,e.deleted?s="d":e.inserted?s="i":e.updated&&(s="u"),t[f]||(t[f]={}),s&&(t[f].op=s),t[f].recordId=c._getIdentity(a),e.originalId&&(t[f].originalId=e.originalId),u.saveSelection&&(t[f].sel=e.sel?"Y":"N"),y.push(t)}if(u.pageItemsToSubmit){let t,i=e.pageItems;if(i||(i=[],e.pageItems=i),C(i)){t=u.pageItemsToSubmit,C(t)||(t=O(t));for(let e=0;e<t.length;e++)i.includes(t[e])||i.push(t[e])}}if(this._requestsInProgress.save||0===this._changes.length&&!u.saveSelection)return null;for(let e in u.fields)M(u.fields,e)&&(t=u.fields[e],t.virtual||(I+=1),t.volatile||t.virtual||(s=u.recordIsArray?t.index:e,_.push(s),p[s]=e,u.recordIsArray&&t.index===this._metaKey&&(f=_.length-1)));u.recordIsArray&&_.sort((function(e,t){return e-t})),f||(f=u.recordIsArray?_.length:"_meta");for(let e=0;e<this._changes.length;e++)r=this._changes[e],r.autoInserted&&!r.updated&&g.push(r.record);g.length&&this.deleteRecords(g);for(let e=0;e<this._changes.length;e++)r=this._changes[e],v(r);if(this._pendingChanges=this._changes,this._changes=[],u.saveSelection)for(const e of this._selection.values())e.inserted||e.deleted||e.updated||v(e);l=e.regions,l||(e.regions=l=[]);for(let e=0;e<l.length&&(a=l[e],a.id!==u.regionId);e++)a=null;return a||(a=D({},u.regionData,{id:u.regionId,ajaxIdentifier:u.ajaxIdentifier,saveData:{models:[]}}),l.push(a)),d=a.saveData.models,o=D({},u.saveData,{instance:this.instance,version:u.version,values:y}),this._addParentItems(o),d.push(o),this._requestsInProgress.save=!0,function(e){e.done((function(e){let t,s;if(!c._destroyed){if(e.errors){for(let t=0;t<e.errors.length;t++){let i=e.errors[t],s=i.message;i.unsafe||(s=n.unescapeHTML(s)),i.regionStaticId===u.regionStaticId&&i.recordId&&i.instance==c.instance&&c.setValidity("error",i.recordId,i.columnName||null,s)}m()}else if(e.regions){let n,r=!1,l=null;for(let i=0;i<e.regions.length;i++){if(t=e.regions[i],t.id===u.regionId){n=t.fetchedData.models;for(let e=0;e<n.length;e++)if(n[e].instance==c.instance){l=n[e].values,c._metaKey||(s=u.recordIsArray?I:"_meta"),l&&(c._updateData(l,s),r=!0);break}break}t=null}if(!r){let t=H(h);i.error("Failed update data after save.",t),e.error=t}c._clearChanges("_pendingChanges")}delete c._requestsInProgress.save}})).fail((function(){m()}))}},setData:function(e,t=0,i=null,n=!1){null===i&&e&&!n&&(i=e.length),this._addData(t,t,e,i,n,!1),0!==t&&null!==t||j(this,c,{})},clearData:function(e=!0){let t=this._requestsInProgress;return!t.fetch&&!t.save&&(this._clear(),e&&j(this,c,{}),!0)},getTotalRecords:function(e){let t=this._options;return t.shape===a?this._haveAllData||t.paginationType===v?this._data.length:this._totalRecords<0&&!0!==e?this._totalRecords:Math.max(this._data.length,this._totalRecords):t.shape===o?e&&null===this._data?0:1:t.shape===d?this._index.size:void 0},getServerTotalRecords:function(){const e=this._options;return e.shape===a?this._totalRecords<0?this._totalRecords:this._totalRecords+this._numInsertedRecords-this._numDeletedRecords:e.shape===o?1:e.shape===d?-1:void 0},getDataOverflow:function(){return!!this._dataOverflow},forEach:function(e,t){const i=this._options,n=this._data;if(i.shape===o)throw J("forEach");if(i.shape===d){let i=0;n&&this.walkTree(n,{node:n=>{z(t,e,n,i,this._getIdentity(n)),i+=1}})}else{const i=n.length;for(let s=0;s<i;s++){let i=n[s];i&&z(t,e,i,s,this._getIdentity(i,s))}}},transform:function(e,t){var i,n,s,r,l,a=/^\[\W*([^ \t/]+)\W*]$/,d=e.template,o=e.showNullAs,h=d.length,c=[],u={},f=this;function g(e,t){var i;return(i=e[t])||(i={values:{},paths:[]},e[t]=i),i}function _(e,t,i,n,s,r){var l,d,o,h,c,u,f,_;if(e){for(c=e.split("/"),u=n,f=null,_=null,o=null,l=0;l<c.length;l++){if(o=c[l],d=a.exec(o)){g(r,d[1]).paths[t]=c.slice(l+1).join("/");break}f=u,_=o,M(u,o)||(u[o]={}),u=u[o]}f?(C(f[_])?(h=f[_]).length=0:h=[],f[_]=h):h=n,s[t]=h}else{if(!C(n))throw new Error("Context must be an array when there is no path");s[t]=n}i&&g(r,i)}function p(e,i,n,s){var r,l,a,d,h=!1;return"string"==typeof e?(r=e.length,a=e.charAt(0),d=e.charAt(r-1),"'"===a&&"'"===d?e.substring(1,r-1):("("===a&&")"===d&&(e=e.substring(1,r-1),h=!0),null!==(l=f.getValue(i,e))&&"object"==typeof l&&M(l,"d")&&(l=h?l.v:l.d),h||!o||null!==l&&""!==l||(l=o),l)):K(e)?e.call(t,f,i,n,s):null===e?e:C(e)?function(e,t,i,n,s){var r,l;for(r=0;r<e.length;r++)void 0!==(l=p(e[r],i,n,s))&&(t[r]=l);return t}(e,[],i,n,s):"object"==typeof e?function(e,t,i,n,s){var r,l;for(r in e)M(e,r)&&void 0!==(l=p(e[r],i,n,s))&&(t[r]=l);return t}(e,{},i,n,s):void 0}function y(e,t,i,n){var s,r,l,d=[];if(e)for(e=e.split("/"),s=0;s<e.length;s++)r=e[s],(l=a.exec(r))&&d.push({key:l[1],value:p(l[1],t,i,n)});return d}function I(i,n,s){var a,o,I,m,v,R,w,x,b,F,M;if(!(n<r||l>0&&n>=r+l)&&(e.includeAggregates||!f._metaKey||!i[f._metaKey].agg)&&(!e.filter||e.filter.call(t,f,i,n,s)))for(a=0;a<h;a++)if(R=null,I=d[a],m=c[a],!I.filter||I.filter.call(t,f,i,n,s)){if(I.uniqueIndexField&&(R=u[I.uniqueIndexField],w=p(I.uniqueIndexField,i,n,s),void 0!==R.values[w]))continue;if(void 0!==(v=p(I.item,i,n,s))){if(R)R.values[w]={index:m.length,arrays:[],indexes:{}};else for(x=y(I.path,i,n,s),M=u,o=0;o<x.length;o++)void 0===(b=(R=g(M,x[o].key)).values[x[o].value])&&(b={index:m.length,arrays:[],indexes:{}},F=""===R.paths[a]?[]:{},m.push(F),R.values[x[o].value]=b),F=m[b.index],b.arrays[a]||_(R.paths[a],a,null,F,b.arrays,b.indexes),m=b.arrays[a],M=b.indexes;m.push(v)}}}for(null!==t&&"object"==typeof t||(t={}),function(){var e,i;for(e=0;e<d.length;e++)_((i=d[e]).path,e,i.uniqueIndexField,t,c,u)}(),r=0,e.offset>=0&&(r=e.offset),l=e.fetchData?this._options.pageSize:null,e.count>0&&(l=e.count),e.fetchData?this.forEachInPage(r,l,I):this.forEach(I),i=0;i<h;i++)n=d[i],s=c[i],n.sort&&s.array.sort(n.sort);return t},forEachInPage:function(e,t,n,s){var r,l,d,o,h=e,c=this,u=this._options,f=this._data;function g(r){var l=t-(r-e);i.trace("Model: "+c.modelId()+". forEachInPage fetching more data starting at: ",r),c._waitingPages.push({offset:r,callback:n,thisArg:s,next:function(){c.forEachInPage(r,l,n,s)}}),c._requestsInProgress.fetch||c.fetch(r,(function(e){e||setTimeout((function(){c._waitingPages.length>0&&c._waitingPages.shift().next()}),1)}))||(c._waitingPages.pop(),z(s,n,null,-1,null))}if(u.shape!==a)throw J("forEachInPage");if(t>u.pageSize&&(u.pageSize=10*Math.floor((t+9)/10)),u.paginationType===m&&(h=e-this._offset),h<0||h>=f.length)this._haveAllData?(z(s,n,null,-1,null),this._drainWaiters()):g(e);else{for(l=h+t,o=e,r=h;r<l;r++){if(void 0===(d=f[r]))return void(this._haveAllData&&r>=f.length?(z(s,n,null,-1,null),this._drainWaiters()):g(r+this._offset));d&&(z(s,n,d,o,this._getIdentity(d,r)),o+=1)}this._drainWaiters()}},indexOf:function(e){const t=this._options.shape;if(t===o)throw J("indexOf");if(e&&void 0!==this._identityKeys){let i=this.getRecordMetadata(this._getIdentity(e));if(t===d)return i&&i.parent?i.parent[this._childrenKey].indexOf(e):-1;if(i)return i.index}return this._data.indexOf(e)},recordAt:function(e){if(this._options.shape!==a)throw J("recordAt");return this._data[e]||null},getRecordId:function(e){return this._getIdentity(e)},getAggregateRecord:function(e,t){var i,n,s,r,l=null;if(t>=0){if(s=this._breakEndIds[t],(i=this.indexOf(this.getRecord(s)))>=0)for(r=!1;i<this._data.length;i++)if((n=(l=this._data[i])[this._metaKey])&&n.agg){if(r=!0,n.agg===e)break}else if(r){l=null;break}}else for(i=this._data.length-1;i>=0;i--){if(!((n=(l=this._data[i])[this._metaKey])&&n.agg&&n.grandTotal)){l=null;break}if(n.agg===e)break}return l},isIdentityField:function(e){return void 0!==this._identityKeys&&this._identityKeys.includes(this.getFieldKey(e))},getRecordMetadata:function(e){const t=this._options;let i,n;return n=e||t.shape!==o?W(e):t.identityField?this.getRecordId(this._data):"0",i=this._index.get(n),i||null},metadataChanged:function(e,t=null,i=null){let n=this._index.get(W(e));n&&j(this,"metaChange",{record:n.record,recordId:e,field:t,property:i})},getTypeMetadata:function(e){return this._options.types[e]||null},getFieldMetadata:function(e){return this._options.fields[e]||null},getFieldKey:function(e){const t=this._options;if(M(t.fields,e)&&!t.fields[e].virtual)return t.recordIsArray?t.fields[e].index:e},isChanged:function(){let e=0;if(0===this._changes.length)return!1;for(let t=0;t<this._changes.length;t++){let i=this._changes[t];i.autoInserted&&!i.updated||(e+=1)}return e>0},getChanges:function(){return this._changes},clearChanges:function(){this._clearChanges("_changes")},hasErrors:function(){return this._errors.length>0},getErrors:function(){return this._errors},setHiddenState:function(e,t){let i=this.getRecordMetadata(e);i&&i.hidden!==t&&(i.hidden=t,this.metadataChanged(e,null,"hidden"))},updateVisibility:function(e=null){const t=this._options,i=t.visibilityFilter;if(i){null!==e&&(t.visibilityFilterContext=e);let n=this,s=t.visibilityFilterContext;if(null===s)return;if(t.shape===d){let e=[];n.walkTree(n.root(),{node:function(t){if(!1===n.hasChildren(t)){let r=i(n,t,s);n.setHiddenState(n.getRecordId(t),!r),r&&(e[e.length-1]=r)}},beginChildren:function(){e.push(null)},endChildren:function(t){let r=!1,l=e.pop();0===e.length&&(r=!0,l=!0),null===l&&(l=i(n,t,s)),n.setHiddenState(n.getRecordId(t),!l),l&&!r&&(e[e.length-1]=l)}},null)}else t.shape===a&&n.forEach((function(e,t,r){let l=i(n,e,s);n.setHiddenState(r,!l)}))}},setDisabledState:function(e,t){let i=this.getRecordMetadata(e);i&&i.disabled!==t&&(i.disabled=t,this._numDisabledRecords+=t?1:-1,this.metadataChanged(e,null,"disabled"))},setSelectionState:function(e,t,i="set"){let n,s,r,l;const a=(e,t)=>{let i=!1;for(let l=e;l<t;l++)r=this._data[l],r?(n=this._getIdentity(r,l),s=this._index.get(n),!s||s.agg||this.isDisabled(r,s)||(s.sel=!0,this._selection.set(n,s))):i=!0;return i};if("all"===i)l=a(0,this.getTotalRecords(!0)),l&&(this._selectRange=[]),this._selectAll=!0;else if(n=W(e),s=this._index.get(n),s){if(t=!!t,this._selectAll&&(this._selectAll=!1,["set","range"].includes(i)&&this.clearSelection()),"range"===i){let e,t,i=s.index;s=this._index.get(this._selectAnchor),s&&(t=s.index,i>t&&(e=i,i=t,t=e),l=a(i,t+1),l&&(this._selectRange=[i,t]))}else s.sel===t||this.isDisabled(s.record,s)||s.agg||(s.sel=t,t?this._selection.set(n,s):this._selection.delete(n)),this._selectAnchor=n,"toggle"!==i&&(this._selectRange=null);if(!this._selectAll){let e=this._index.size-this._numAggregateRecords-this._numDisabledRecords;this.getSelectedCount()===e&&(this._selectAll=!0)}}},clearSelection:function(){for(const e of this._selection.values())e.sel=!1;this._selection.clear(),this._selectAll=!1,this._selectRange=null},getSelectedCount:function(){return this._selection.size},getSelectedRecords:function(){return[...this._selection.values()].sort(((e,t)=>e.index-t.index)).map((e=>e.record))},getSelectionState:function(){return{selectAll:this._selectAll,incomplete:null!=this._selectRange,rangeAnchor:this._selectAnchor}},allowEdit:function(e){return this.check("canEdit",e)},allowDelete:function(e){const t=this._options;if(t.shape===o||t.shape===d&&e===this._data)return!1;if(t.shape===d){let t=!0,i=!1;if(this.walkTree(e,{node:e=>{if(i&&t&&(this.check("canDelete",e)||(t=!1)),!t)return!0},beginChildren:()=>{i=!0}}),!t)return!1}return this.check("canDelete",e)},allowAdd:function(e,t,i){const n=this._options;let s,r,l;if(n.shape===o)return!1;if(!(n.shape!==d||e&&e[this._childrenKey]))return!1;if(r=this.check("canAdd",e,t,i),r&&i&&n.shape===d&&(l=this._getType(e),s=void 0!==l.validChildren?l.validChildren:void 0===n.types.default.validChildren||n.types.default.validChildren,!0!==s))for(let e=0;e<i.length;e++)if(!s.includes(i[e][this._typeKey])){r=!1;break}return r},allowDrag:function(e){return this._options.shape!==o&&this.check("canDrag",e)},dragOperations:function(e){const t=this._options;let i,n;if(e){if(e.length>0&&this._typeKey){n=e[0][this._typeKey]||"default";for(let t=1;t<e.length;t++)if((e[t][this._typeKey]||"default")!==n){n="default";break}}else n="default";i=t.types[n].operations&&void 0!==t.types[n].operations.drag?t.types[n].operations.drag:t.types.default.operations.drag}else i=t.types.default.operations.externalDrag;return i},check:function(e,t,i,n){const s=this._options,r=this._getType(t);let l,a=!1;if(!s.editable||this._masterRecordIsDeleted)return!1;if(t&&(l=this.getRecordMetadata(this._getIdentity(t)),l)){if(l.deleted||l.agg)return!1;if(l.inserted&&("canEdit"===e||"canDelete"===e))return!0}return l&&void 0!==l[e]?a=l[e]:r.operations&&void 0!==r.operations[e]?a=r.operations[e]:void 0!==s.types.default.operations[e]&&(a=s.types.default.operations[e]),K(a)&&(a=a.call(this,t,i,n)),K(s.check)&&(a=s.check(a,e,t,i,n)),a},isDisabled:function(e,t){const n=this._options,s=this._getType(e);let r=!1;return t?t.record!==e&&i.warn("Model: incorrect metadata or duplicate record id detected:",this.getRecordId(e)):t=this.getRecordMetadata(this.getRecordId(e)),null!=t.disabled?r=t.disabled:void 0!==s.isDisabled?r=s.isDisabled:void 0!==n.types.default.isDisabled&&(r=n.types.default.isDisabled),r},getValue:function(e,t){return void 0===t&&(t=e,e=this._data),e[this.getFieldKey(t)]},setValue:function(e,t,i,n){var s,r,l,a,o,h,c,u,f,g,_,p,I,m=this._options,v=!1;if(void 0===i&&(i=t,t=e,e=this._data),l=this.getFieldKey(t),!this.allowEdit(e))throw new Error("Set value not allowed for record");if(c=this._getIdentity(e),!(a=this.getRecordMetadata(c)))return null;if(I=m.fields[t],void 0===l||I.readonly&&!I.parentField||a.fields&&a.fields[t]&&a.fields[t].ck)throw new Error("Set value not allowed for field");if(r=e[l],!T(r,i)){if(!n&&(t===m.sequenceField||t===m.parentIdentityField))if(u=f=g=null,t===m.sequenceField){if(m.shape===d?(f=this.parent())&&(u=f[this._childrenKey]):u=this._data,u){let t=parseFloat(i);for(s=0;s<u.length&&!(parseFloat(u[s][this._sequenceKey])>t);s++)g=u[s];g===e&&(g=null)}}else t===m.parentIdentityField&&(f=this.getRecord(i));if(a.original||(a.original=function(e){let t,i;if(C(e))for(i=[],t=0;t<e.length;t++)i[t]=N(e[t]);else for(t in i={},e)M(e,t)&&(i[t]=N(e[t]));return i}(e),v=!0),e[l]=i,(h=this._getIdentity(e))!==c){if(this._index.has(h))return e[l]=r,v&&delete a.original,"DUP";a.originalId||(a.originalId=c),this._index.delete(c),this._index.set(h,a),a.sel&&(this._selection.delete(c),this._selection.set(h,a))}return a.updated||a.deleted||a.inserted||this._addChange(a),m.trackChanges&&(a.updated=!0),a.fields||(a.fields={}),(o=a.fields[t])||(o={},a.fields[t]=o),m.trackChanges&&(o.changed=!0),(a.error||a.warning)&&this.setValidity("valid",h),j(this,y,{oldValue:r,oldIdentity:h!==c?c:null,recordId:h,record:e,field:t}),this._checkAggregates(t),(_=this._dependentFields[t])&&(I.calcValue&&((p={})[t]=1),ie(this,a,_,!0,p)),(f||g)&&this.moveRecords([e],f,g),"SET"}return"NC"},getRecordValue:function(e,t){return this.getValue(this.getRecord(e),t)},setRecordValue:function(e,t,i){this.setValue(this.getRecord(e),t,i)},setValidity:function(e,t,i,n){let s,r,l,a,d,o,h,c=this._index.get(W(t));if(c&&(i?(c.fields||(c.fields={}),r=c.fields[i],r||(r={},c.fields[i]=r)):r=c,d="valid",o=r.message||n,r.warning&&(d="warning"),r.error&&(d="error"),e!==d||o!==n)){switch(h="message",e){case"error":s="error",delete r.warning;break;case"warning":s="warning",delete r.error;break;case"valid":delete r.error,delete r.warning,delete r.message;break;default:throw new Error("Invalid value for pValidity parameter: "+e)}if(e!==d&&("valid"!==d&&(h+=","+d),s&&(h+=","+s)),s&&(r[s]=!0,r.message=n),l=c.error,!l&&c.fields)for(let e in c.fields)if(M(c.fields,e)&&c.fields[e].error){l=!0;break}l?(a=this._errors.indexOf(c),a>=0&&this._errors.splice(a,1),this._errors.push(c)):this._removeError(c),this.metadataChanged(t,i,h)}},deleteRecords:function(e){const t=this._options,n=[],s=[],r=[];let l=-1;if(t.shape===o)throw J("deleteRecords");for(let s=0;s<e.length;s++){let r=e[s],l=this._getIdentity(r);this.getRecordMetadata(l)?this.allowDelete(r)?t.shape===d?this.walkTree(r,{postNode:e=>{n.push(e)}}):n.push(r):i.warn("Delete not allowed for record: "+l):i.warn("Record to delete not found: "+l)}for(let e=0;e<n.length;e++){const i=n[e],d=this._getIdentity(i),o=this.getRecordMetadata(d);t.shape===a&&(this._numDeletedRecords+=1),t.onlyMarkForDelete&&!o.inserted||(t.shape===a&&o.inserted&&(this._numDeletedRecords-=1,this._numInsertedRecords-=1),this._removeRecord(d,o),t.shape===a&&(-1===l||o.index<l)&&(l=o.index)),o.inserted?(delete o.inserted,delete o.autoInserted,delete o.updated,this._removeError(o),this._removeChange(o)):(L(o,!0),this._removeError(o),t.trackChanges&&(o.deleted=!0),this._addChange(o)),s.push(i),r.push(d)}return l>=0&&this._resequenceServerOffset(l),s.length>0&&(j(this,_,{records:s,recordIds:r}),this._checkAggregates()),s.length},canRevertRecord:function(e){const t=this.getRecordMetadata(this._getIdentity(e));return!(!t||!t.original&&!t.deleted)},revertRecords:function(e){const t=this._options;let n={},s=[],r=[];for(let l=0;l<e.length;l++){let h,c,u=e[l],f=this._getIdentity(u),g=this.getRecordMetadata(f);g?g.original||g.deleted?(t.shape===a?(h=this._data,c=g.index):t.shape===d&&(h=this.parent(g.record)[this._childrenKey],c=h.indexOf(g.record)),g.deleted?(t.shape===a&&(this._numDeletedRecords-=1),delete g.deleted):(g.originalId&&(this._index.set(g.originalId,g),this._index.delete(f),g.sel&&(this._selection.set(g.originalId,g),this._selection.delete(f)),n[f]=g.originalId,delete g.originalId),g.original&&(g.record=g.original,delete g.original),delete g.updated),L(g),this._removeError(g),this._removeChange(g),u=g.record,t.shape!==o&&h[c]!==u&&(h[c]=u),s.push(u),r.push(f)):i.warn("Nothing to revert for record "+f):i.warn("Record to revert not found: "+f)}return s.length>0&&(j(this,f,{records:s,recordIds:r,newIds:n}),this._checkAggregates()),s.length},insertNewRecord:function(e,t,i){const n=this._options;let s,r,l,h,c,u,f=null;if(n.shape===o)throw J("insertNewRecord");if(h=this._initRecord(i,null,e),!this.allowAdd(e,"new",[h]))throw new Error("Insert not allowed for new record");if(n.shape===d?(u=e||this._data,c=u[this._childrenKey]):c=this._data,r=0,t&&(f=this._getIdentity(t),s=this.getRecordMetadata(f),s&&(r=n.shape===a?s.index+1:c.indexOf(s.record)+1)),this._sequenceKey){let e=parseFloat(h[this._sequenceKey])||null,[t,i]=G(c,r,this._sequenceKey);h[this._sequenceKey]=""+Y(n.sequenceStep,t,i,1,1,e)}return c.splice(r,0,h),s={record:h},n.shape===a&&(this._reindex(r+1),s.index=r),l=this._getIdentity(h),n.trackChanges&&(s.inserted=!0),this._index.set(l,s),this._addChange(s),n.shape===d?s.parent=u:this._numInsertedRecords+=1,ne(this,s),j(this,"insert",{record:h,recordId:l,insertAfterId:f}),l},moveRecords:function(e,t,n){let s,r,l,a,h,c,u,f,g,_,p,y=this._options,I=[],m=[],v=null;if(y.shape===o)throw J("moveRecords");y.shape===d?(t||(t=this._data),l=t[this._childrenKey]):l=this._data,r=0,n&&(v=this._getIdentity(n),s=this.getRecordMetadata(v),s&&(r=l.indexOf(s.record)+1),(!s||r<0)&&(i.warn("AfterRecord not found, move to beginning."),r=0)),this._sequenceKey&&([f,g]=G(l,r,this._sequenceKey)),p=0,_=this._data.length;for(let n=0;n<e.length;n++)if(c=e[n],u=this._getIdentity(c),s=this.getRecordMetadata(u),s){if(y.shape===d){if(a=this.parent(c),!a){i.warn("Move not allowed for root");continue}a=a[this._childrenKey]}else a=l;if(h=a.indexOf(c),y.shape!==d&&(h>p&&(p=h),h<_&&(_=h)),a.splice(h,1),l===a&&h<r&&(r-=1),m.push(c),I.push(u),l.splice(r,0,c),y.shape!==d&&(r>p&&(p=r),r<_&&(_=r)),r+=1,this._sequenceKey){let t=parseFloat(c[this._sequenceKey])||null;this.setValue(c,y.sequenceField,""+Y(y.sequenceStep,f,g,e.length,n+1,t),!0)}y.shape===d&&(s.parent=t,this._parentIdKey&&this.setValue(c,y.parentIdentityField,this._getIdentity(t),!0))}else i.warn("Record to move not found: "+u);return y.shape!==d&&(this._reindex(_,p+1),this._resequenceServerOffset(_)),j(this,"move",{records:m,recordIds:I,insertAfterId:v}),I},copyRecords:function(e,t,n){let s,r,l,a,h,c,u,f,g,_,p=this,y=this._options,I=[],m=[],v=null;if(y.shape===o)throw J("copyRecords");y.shape===d?(f={node:function(e,t){var i,n;t&&(i=p._getIdentity(e),n={record:e,inserted:!0,parent:t},p._index.set(i,n),p._addChange(n))}},t||(t=this._data),c=t[this._childrenKey]):c=this._data,r=0,n&&(v=this._getIdentity(n),s=this.getRecordMetadata(v),s&&(r=c.indexOf(s.record)+1),(!s||r<0)&&(i.warn("AfterRecord not found, copy to beginning."),r=0)),this._sequenceKey&&([g,_]=G(c,r,this._sequenceKey));for(let n=0;n<e.length;n++)l=e[n],h=this._getIdentity(l),s=this.getRecordMetadata(h),s?(a=this._initRecord(null,e[n],t),c.splice(r,0,a),this._sequenceKey&&(a[this._sequenceKey]=""+Y(y.sequenceStep,g,_,e.length,n+1)),u=this._getIdentity(a),m.push(a),I.push(u),s={record:a,inserted:!0,index:r},this._index.set(u,s),this._addChange(s),y.shape===d?(s.parent=t,this.walkTree(a,f,null)):this._numInsertedRecords+=1,r+=1):i.warn("Record to copy not found: "+h);return this._reindex(r),j(this,"copy",{records:m,recordIds:I,insertAfterId:v}),this._checkAggregates(),I},root:function(){if(this._options.shape!==d)throw J("root");return this._data},child:function(e,t){const i=e[this._childrenKey];if(i)return i[t]},parent:function(e){if(this._identityKeys){let t=this._getIdentity(e),i=this.getRecordMetadata(t);if(i&&M(i,"parent"))return i.parent?i.parent:null}},childCount:function(e){const t=e[this._childrenKey];return null===t?null:t?t.length:0},hasChildren:function(e){const t=e[this._childrenKey];return null===t?null:!!t&&t.length>0},fetchChildNodes:function(e,t){let i,n,s,r,l,a=this._options,d=S();return l=D({},a.regionData,{id:a.regionId,ajaxIdentifier:a.ajaxIdentifier,fetchData:D({},a.fetchData,{version:a.version,parentId:e?this._getPrimaryKey(e):null})}),s={regions:[l]},a.pageItemsToSubmit&&(s.pageItems=a.pageItemsToSubmit),this._addParentItems(s.regions[0]),r=B(a,this),e&&delete r.loadingIndicator,i=this._callServer(s,r),i.done((t=>{if(this._destroyed)return;let i,n=t.regions[0].fetchedData;if(e){let t=n[this._childrenKey];this._addData(e,null,t),i=t.length}else this._addData(null,null,n.root),i=1;d.resolve(i)})).fail((function(e,t,i){d.reject(H("Error fetching child nodes.",e,0,i))})),n=d.promise(),t&&n.always(t),n},clearChildNodes:function(e){e[this._childrenKey]=null},walkTree:function(e,t,i){let n,s,r,l;if(e&&(void 0===i&&(i=null,n=this._getIdentity(e),n&&(s=this.getRecordMetadata(n),s&&(i=s.parent))),!t.node||(l=t.node(e,i),!l))){if(r=e[this._childrenKey],r&&r.length>0){t.beginChildren&&t.beginChildren(e);for(let i=0;i<r.length;i++)this.walkTree(r[i],t,e);t.endChildren&&t.endChildren(e)}t.postNode&&t.postNode(e,i)}},subscribe:function(e){let t=e.viewId;return t||(t="v::"+x,x+=1,e.viewId=t),this._listeners.push(e),t},unSubscribe:function(e){for(let t=0;t<this._listeners.length;t++)this._listeners[t].viewId===e&&this._listeners.splice(t,1)},getOption:function(e){const t=this._options[e];if(void 0===t)throw new Error("No such option: "+e);return t},setOption:function(e,t){const n=this._options;if(F.has(e)){if("editable"===e&&!n.identityField&&n.shape!==o)throw Q();"trackChanges"===e&&!t&&n.onlyMarkForDelete&&(n.onlyMarkForDelete=!1),"onlyMarkForDelete"===e&&!1===n.trackChanges&&(t&&i.warn(e+" cannot be true when trackChanges is false"),t=!1),n[e]=t}else i.warn("Option cannot be set: "+e)},_callServer:function(e,i){return(this._options.callServer||t.plugin)(e,i)},_drainWaiters:function(e){for(let t=0;t<this._waitingPages.length;t++){let i=this._waitingPages[t];if((this._haveAllData||this._data[i.offset]||e)&&(this._waitingPages.splice(t,1),t-=1,e&&0!==e.status?z(i.thisArg,i.callback,null,-1,null,e):i.next(),this._requestsInProgress.fetch))return}},_getServerOffset:function(e){var t,i,n,s=e-1;for(n=this._data[s];n;){if(t=this._getIdentity(n,s),(i=this.getRecordMetadata(t))&&i.serverOffset>=0)return i.serverOffset+1;s-=1,n=this._data[s]}return e},_clear:function(){let e=this._options;(this._requestsInProgress.fetch||this._requestsInProgress.save)&&i.error("Model cleared during ajax request"),this._haveAllData=!1,e.shape===a?(this._data=[],e.hasTotalRecords?this._totalRecords=0:this._totalRecords=-1,this._offset=0,this._numInsertedRecords=0,this._numDeletedRecords=0,this._numAggregateRecords=0,this._numDisabledRecords=0,this._masterRecordIsInserted&&(this._haveAllData=!0),this._dataOverflow=!1):this._data=null,this._changes=[],this._errors=[],this._index.clear(),this._breakEndIds=[],this._selection.clear(),this._selectAll=!1,this._selectRange=null,this._selectAnchor=null},_saveDataState:function(){this._saveState={_data:this._data,_totalRecords:this._totalRecords,_haveAllData:this._haveAllData,_offset:this._offset,_numInsertedRecords:this._numInsertedRecords,_numDeletedRecords:this._numDeletedRecords,_numAggregateRecords:this._numAggregateRecords,_numDisabledRecords:this._numDisabledRecords,_dataOverflow:this._dataOverflow,_changes:this._changes,_errors:this._errors,_index:this._index,_breakEndIds:this._breakEndIds,_selection:this._selection,_selectAll:this._selectAll,_selectRange:this._selectRange},this._index=new Map,this._selection=new Map},_restoreDataState:function(){const e=this._saveState;this._data=e._data,this._totalRecords=e._totalRecords,this._haveAllData=e._haveAllData,this._offset=e._offset,this._numInsertedRecords=e._numInsertedRecords,this._numDeletedRecords=e._numDeletedRecords,this._numAggregateRecords=e._numAggregateRecords,this._numDisabledRecords=e._numDisabledRecords,this._dataOverflow=e._dataOverflow,this._changes=e._changes,this._errors=e._errors,this._index=e._index,this._breakEndIds=e._breakEndIds,this._selection=e._selection,this._selectAll=e._selectAll,this._selectRange=e._selectRange},_clearChanges:function(e){const t=[],i=[],n=this._options,s=this[e];let r=-1,l=!1;for(let e=0;e<s.length;e++){const d=s[e],o=this._getIdentity(d.record);d.deleted&&n.onlyMarkForDelete&&(this._removeRecord(o,d),n.shape===a&&(l=!0)),d.deleted?t.push(o):(d.inserted||d.updated)&&(i.push(o),d.inserted&&n.shape===a&&(d.serverOffset=0,l=!0)),l&&(-1===r||d.index<r)&&(r=d.index),delete d.deleted,delete d.recordId,delete d.inserted,delete d.autoInserted,delete d.updated,delete d.original}l&&this._resequenceServerOffset(r),this._totalRecords>=0&&(this._totalRecords+=this._numInsertedRecords,this._totalRecords-=this._numDeletedRecords),this._numInsertedRecords=0,this._numDeletedRecords=0,this[e]=[],j(this,p,{deletedIds:t,changedIds:i})},_reindex:function(e,t){const i=this._data;let n=i.length;null!=t&&t<n&&(n=t);for(let t=e;t<n;t++)if(void 0!==i[t]){let e=this._getIdentity(i[t]);this.getRecordMetadata(e).index=t}},_resequenceServerOffset:function(e=0){const t=this._data;let i,n,s=-1;for(;e>0&&(i=t[e-1],s=this.getRecordMetadata(this.getRecordId(i)).serverOffset,void 0===s);)e-=1;for(let r=e;r<t.length;r++)i=t[r],i?(n=this.getRecordMetadata(this.getRecordId(i)),n.serverOffset>=0&&(s+=1,n.serverOffset=s)):s+=1},_addData:function(e,t,n,s,r,l){const h=this._options,c=this,f=this._calculatedFields.length>0;let g,_,p,y,I,R,w,x,b,F,M,C;function A(e,t,i,n){const s={record:n};return c._metaKey&&(D(s,n[c._metaKey]),s.sel=!0===s.sel||"Y"===s.sel,null!=s.disabled&&(s.disabled=!0===s.disabled||"Y"===s.disabled),s.agg&&(!e||c._identityKeys&&!n[c._identityKeys[0]])&&(c._assignTempIdentity(n),e=c._getIdentity(n)),U(s)),null!=t&&(s.serverOffset=t),null!=i&&(s.index=i),s.agg&&(c._numAggregateRecords+=1),s.disabled&&(c._numDisabledRecords+=1),c._index.set(e,s),(s.sel||c._selectAll||c._selectRange&&i>c._selectRange[0]&&i<=c._selectRange[1])&&(s.agg||s.disabled?delete s.sel:(s.sel=!0,c._selection.set(e,s))),h.visibilityFilter&&h.visibilityFilterContext&&(s.hidden=!h.visibilityFilter(c,n,h.visibilityFilterContext)),te(n,h.fields,h.recordIsArray),f&&!s.agg&&ne(c,s),s}function K(e,t,i){let n=0;for(let s=0;s<c._aggregateRecs.length;s++){let r,l,a,d,o=c._aggregateRecs[s];t[o]||(l=c._initRecord(!1),d=c._getIdentity(l),a={agg:o},i&&(a.grandTotal=i),l[c._metaKey]=a,r=e+n,c._data[r]?c._data.splice(r,0,l):c._data[r]=l,A(d,null,r,l),n+=1)}return n}function S(e,t,i,n,s){if(c._data.length>0&&c._haveAllData&&c._aggregateRecs.length>0){if(n){if(t&&t.grandTotal){for(e=c._data.length-1;e>=0&&(i=c._data[e],(t=c._metaKey&&i[c._metaKey])&&t.agg&&t.grandTotal);e--);e+=1}e+=K(e,s),c._reindex(e)}(e=K(c._data.length,s,!0))>0&&c._checkAggregates()}}function T(){if(null!==c._selectRange){let e=c._selectRange[0]+1,t=c._selectRange[1]-1;c._selectAll&&(e=0,t=c.getTotalRecords(!0));for(let i=e;i<t;i++)if(!c._data[i])return;c._selectRange=null}}if(h.shape===a?((0===e&&!this.isChanged()||h.paginationType===v)&&this._clear(),h.paginationType===m&&(this._offset=e),this._totalRecords=-1,null!=s?this._totalRecords=s:h.hasTotalRecords&&i.warn("Model missing total records"),this._haveAllData||r||(this._haveAllData=!0),l&&(this._dataOverflow=!0)):h.shape===o&&this._clear(),h.shape===d&&e)i.trace("Model: "+this.modelId()+". add data subtree: ",e),R=e,R[this._childrenKey]=n,h.identityField&&c.walkTree(R,{node:function(e,t){t&&(A(c._getIdentity(e),null,null,e).parent=t)}},null),j(this,u,{parentNode:R,offset:0,count:n.length});else if(null===this._data||0===this._data.length||h.shape!==a||h.paginationType===m){if(i.trace("Model: "+this.modelId()+". add data set: ",e,n?.length,s,r),this._data=n,this._numInsertedRecords=0,this._numDeletedRecords=0,this._numAggregateRecords=0,this._numDisabledRecords=0,h.shape!==o)if(b={offset:0,count:n.length},w=t,h.shape===d&&this.root())h.identityField&&this.walkTree(this.root(),{node:function(e,t){let i,n=c._getIdentity(e);c._metaKey&&e[c._metaKey].agg?x=null:(x=w,w+=1),i=A(n,x,null,e),i.parent=t}},null),b.parentNode=null,b.count=1;else{let e;for(M=!1,C={},e=0;e<this._data.length;e++)p=this._data[e],g=this._getIdentity(p,e),_=this._metaKey&&p[this._metaKey],_&&_.agg?(x=null,C[_.agg]=1):(x=w,w+=1,M&&(e+=K(e,C)),M=!1),_&&_.endControlBreak&&(this._breakEndIds.push(g),this._aggregateRecs.length>0&&(M=!0,C={})),A(g,x,e,p);S(e,_,p,M,C),T()}else this._data?(this._haveAllData=!0,b={offset:0,count:1},A(this._getIdentity(this._data),null,null,this._data)):(this._haveAllData=!0,b={offset:0,count:0});j(this,u,b)}else{let l;for(i.trace("Model: "+this.modelId()+". add data merge: ",e,n?.length,s,r),y=e,w=t,F=[],M=!1,C={},l=0;l<n.length;l++){if(p=n[l],g=this._getIdentity(p,y),_=this._metaKey&&p[this._metaKey],_&&_.agg?(x=null,C[_.agg]=1):(x=w,w+=1),I=this.getRecordMetadata(g),I){if(I.updated||I.inserted||I.deleted)continue;this._data[I.index]=p,te(p,h.fields,h.recordIsArray),I.record=p,w-=1,_&&D(I,_),F.push(g),f&&!I.agg&&ne(this,I)}else this._data[y]?this._data.splice(y,0,p):this._data[y]=p,A(g,x,y,p),y+=1;_&&(_.agg||(M&&(y+=K(y,C)),M=!1),_.endControlBreak&&(this._breakEndIds.push(g),this._aggregateRecs.length>0&&(M=!0,C={})))}S(l,_,p,M,C),T(),b={offset:e,count:y-e},F.length&&(b.replacedIds=F),j(this,u,b)}},_updateData:function(e,t){const i=this._options,n=[],s=[],r=[],l=[],a={},d=t||this._metaKey;let o=!1,h=-1;for(let o=0;o<e.length;o++){const c=e[o],u=c[d];let f,g,_=u?u.recordId:null;u&&_&&u.notFound?(f=this.getRecordMetadata(_),this._removeRecord(_,f),r.push(f.record),l.push(_),(-1===h||f.index<h)&&(h=f.index)):(g=this._getIdentity(c),_===g&&(_=null),f=this.getRecordMetadata(_||g),f&&(_&&(a[_]=g,this._index.set(g,f),this._index.delete(_),this._selection.delete(_),f.sel&&this._selection.set(g,f),(-1===h||f.index<h)&&(h=f.index),f.serverOffset=0),n.push(c),s.push(_||g),this._data[f.index]=c,te(c,i.fields,i.recordIsArray),f.record=c,d&&u?(D(!0,f,u),f.highlight&&void 0===u.highlight&&delete f.highlight,U(f),delete f.recordId):t&&(i.recordIsArray?c.splice(t,1):delete c[t]),i.visibilityFilter&&i.visibilityFilterContext&&(f.hidden=!i.visibilityFilter(this,c,i.visibilityFilterContext)),ne(this,f),delete f.deleted,delete f.inserted,delete f.autoInserted,delete f.updated,delete f.original,L(f),this._removeError(f),this._removeChange(f)))}h>=0&&this._resequenceServerOffset(h),n.length>0&&(j(this,g,{records:n,recordIds:s,newIds:a}),o=!0),r.length>0&&(this._totalRecords>=r.length&&(this._totalRecords-=r.length),j(this,_,{records:r,recordIds:l}),o=!0),o&&this._checkAggregates()},_initRecord:function(t,i,n){var s,r,l,a,o,h,c,u,f,g,_=!0,p=this._options;if(t)h=t;else for(s in!1===t&&(_=!1),h=p.recordIsArray?[]:{},p.fields)if(M(p.fields,s)&&(r=p.fields[s],l=p.recordIsArray?r.index:s,!r.virtual))if(!i||r.noCopy){if(r.parentField&&p.parentModel&&(c||(c=e.get(p.parentModel))&&!u&&p.parentRecordId&&(u=c.getRecord(p.parentRecordId)),u)){h[l]=c.getValue(u,r.parentField);continue}f="",_&&void 0!==(g=r.defaultValue)&&(f="function"==typeof g?g(this,i):g),h[l]=f}else this._identityKeys.includes(l)||(h[l]=i[l]);if(c&&e.release(p.parentModel),this._identityKeys&&this._assignTempIdentity(h),this._metaKey&&void 0===h[this._metaKey]&&(h[this._metaKey]={}),p.shape===d&&(this._parentIdKey&&(h[this._parentIdKey]=this._getIdentity(n)),o=[],h[this._childrenKey]=o,i&&(a=i[this._childrenKey])))for(s=0;s<a.length;s++)o.push(this._initRecord(null,a[s],h));return h},_assignTempIdentity:function(e){for(let t=0;t<this._identityKeys.length;t++)e[this._identityKeys[t]]||(e[this._identityKeys[t]]=this._options.genIdPrefix+P(this.name))},_getIdentity:function(e,t){let i=null;if(void 0!==this._identityKeys)if(1===this._identityKeys.length)i=e[this._identityKeys[0]]+"";else{i=[];for(let t=0;t<this._identityKeys.length;t++)i.push(e[this._identityKeys[t]]+"")}else null!=t?i=t+"":this._options.shape===o&&(i="0");return null!==i?W(i):i},_getPrimaryKey:function(e){var t,i;if(void 0!==this._identityKeys)for(i=[],t=0;t<this._identityKeys.length;t++)i.push(e[this._identityKeys[t]]+"");return i},_getType:function(e){let t="default",i=this._options;return e&&void 0!==this._typeKey&&(t=e[this._typeKey],null!==t&&E(t)&&(t=t.v),t||(t="default")),i.types[t]||i.types.default},_getRecordById:function(e){let t=this._index.get(W(e));return t?t.record:null},_removeRecord:function(e,t){const i=this._options;let n,s,r;i.shape===a?(n=this._data,r=t.index):i.shape===d&&(n=t.parent[this._childrenKey],r=n.indexOf(t.record),delete t.parent),n.splice(r,1),this._reindex(r),s=W(e),this._index.delete(s),t.sel&&this._selection.delete(s)},_addChange:function(e){if(!this._options.trackChanges)return;let t=this._changes.indexOf(e);t>=0&&this._changes.splice(t,1),this._changes.push(e)},_removeChange:function(e){if(!this._options.trackChanges)return;let t=this._changes.indexOf(e);t>=0&&!e.deleted&&!e.updated&&!e.inserted&&this._changes.splice(t,1)},_removeError:function(e){let t=this._errors.indexOf(e);t>=0&&this._errors.splice(t,1)},_addParentItems:function(t){var i,n,s,r,l,a,d={values:[]},o=this._options;if(o.parentModel&&o.parentRecordId){for(i in o.fields)M(o.fields,i)&&(n=o.fields[i]).parentField&&(s||(s=e.get(o.parentModel))&&!r&&(r=s.getRecord(o.parentRecordId),a=s.getRecordMetadata(o.parentRecordId)),r&&(l={n:n.parentField,v:s.getValue(r,n.parentField)},d.values.push(l)));a&&(a.salt&&(d.salt=a.salt),a.protected&&(d.protected=a.protected)),s&&e.release(o.parentModel),t.parentRecordId=o.parentRecordId,d.values.length>0&&(t.parentItems=d)}},_updateAggregates:function(){var e,t,i,n,s,l,a=this._options.fields,d=[];if(!(this._staleAggFields.length<=0)){for(e=0;e<this._staleAggFields.length;e++)for(i=a[n=this._staleAggFields[e]],t=0;t<i.aggregates.length;t++)"string"==typeof(s=i.aggregates[t])&&(s=se[s]),(l={name:s.name,fieldName:n,key:this.getFieldKey(this._staleAggFields[e]),state:{dataType:i.dataType,formatMask:i.formatMask},agg:s}).agg.init(l.state),d.push(l);this.forEach((function(e,t,i){var n,s,a,o=this.getRecordMetadata(i);for(n=0;n<d.length;n++)if(l=d[n],o.agg){if(o.agg===l.name){let t=l.state.dataType,n=l.state.formatMask;a=e[l.key],s=l.agg.get(l.state,!o.grandTotal)+"",s="NUMBER"===t&&n?r.formatNumber(s,n):""+s,e[l.key]=s,j(this,y,{oldValue:a,oldIdentity:null,recordId:i,record:e,field:l.fieldName})}}else o.deleted||(s=e[l.key],l.agg.add(l.state,s))}),this),this._staleAggFields=[]}},_checkAggregates:function(e){if(e)this._aggregatedFields[e]&&this._staleAggFields.indexOf(e)<0&&(this._staleAggFields.push(e),this._debouncedUpdateAggregates());else for(let e in this._aggregatedFields)M(this._aggregatedFields,e)&&this._checkAggregates(e)},_recalculate:function(e){this.forEach((function(t,i,n){const s=this.getRecordMetadata(n);s.agg||ie(this,s,e,!0)}),this)}},le={shape:a,recordIsArray:!1,hasTotalRecords:!1,genIdPrefix:"t",regionId:null,ajaxIdentifier:null,pageItemsToSubmit:null,regionData:{},fetchData:{},saveData:{},requestOptions:{},version:1,parentModel:null,parentRecordId:null,editable:!1,trackChanges:!0,onlyMarkForDelete:!0,identityField:null,typeField:null,childrenField:null,parentIdentityField:null,sequenceField:null,metaField:null,sequenceStep:10,saveSelection:!1,types:{default:{isDisabled:!1,validChildren:!0,operations:{canAdd:!0,canEdit:!0,canDelete:!0,canDrag:!0,drag:{normal:"move",ctrl:"copy"},externalDrag:{normal:"add"}}}},check:null,sortCompare:null,callServer:null,paginationType:v,pageSize:100,preFetch:!1,visibilityFilterContext:null,visibilityFilter:null},ae=new Set([a,d,o]),de=new Set([v,m,"progressive"]);function oe(e){const t=q(e);let i=R[t[0]];return i&&(i=t[1]?i.instances[t[1]]:i.model),i}function he(e,t,i,n){let s=n?q(n):null,r=[];function l(n){let r=!(!i&&!n._options.regionId);return r&&("change"===e?r=n.isChanged():"error"===e&&(r=n.hasErrors()),r&&t&&(r=function(e){let t,i=e,n=q(i.modelId());for(;n;){if(n[0]===s[0]&&(n[1]===s[1]||null===s[1]))return!0;n=null,t=i.getOption("parentModel"),t&&(i=oe(t),i&&(n=q(t)))}return!1}(n))),r}function a(e,t){r.push({id:e,model:t})}function d(e,t){e.model&&l(e.model)&&a(t,e.model);for(let i in e.instances)M(e.instances,i)&&l(e.instances[i])&&a([t,i],e.instances[i])}if(s||(t=!1),!t&&s&&s[0]){let e=s[0],t=R[e];t&&(s[1]?t.instances[s[1]]&&l(t.instances[s[1]])&&a([e,s[1]],t.instances[s[1]]):d(t,e))}else for(let e in R)M(R,e)&&d(R[e],e);return r}function ce(e){let t=w.indexOf(e);t>=0&&w.splice(t,1)}e.create=function(t,r,h,u,m,x){const F=q(t),A=Object.create(re);let K,S,T,k,O,E,V,P,N,z,U;function W(e,t){const n=K.fields[e];(n.calcValue||n.dependsOn||n.aggregates&&n.aggregates.length>0)&&(i.warn("Model "+t+" field does not support calculations"),delete n.calcValue,delete n.dependsOn)}if(A.name=F[0],A.instance=F[1],A._requestsInProgress={},A._listeners=[],A._waitingPages=[],S=r.fields,A._options=D(!0,{},le,r),A._options.fields=S,K=A._options,!K.fields)throw new Error("The fields option is required");if(!ae.has(K.shape))throw new Error("Invalid shape option: "+K.shape);if(!de.has(K.paginationType))throw new Error("Invalid paginationType option: "+K.paginationType);if(K.editable&&!K.identityField&&K.shape!==o)throw Q();if(K.shape===d&&!K.childrenField)throw new Error("A tree shaped model requires a childrenField");if(K.shape===a&&K.paginationType===v&&void 0===r.hasTotalRecords&&(K.hasTotalRecords=!0),!K.trackChanges&&K.onlyMarkForDelete&&(r.onlyMarkForDelete&&i.warn("Model forcing onlyMarkForDelete to false"),K.onlyMarkForDelete=!1),A._dependentFields={},A._calculatedFields=[],A._aggregatedFields={},A._aggregateRecs=[],function(e,t,i,r,a){let d,o,h,c,u,f,g,_=[],p={};const y=function(e){const t=e.target.id;A._recalculate(A._dependentFields[":"+t])};for(o in e)if(M(e,o)){if(h=e[o],h.calcValue&&i.push(o),c=h.dependsOn,c)for(let i=0;i<c.length;i++){if(f=c[i],":"===f.substr(0,1)){if(g=f.substr(1),!s(g).node)throw Z(o,g);_.push(g)}else if(!e[f])throw Z(o,f);I=o,t[m=f]||(t[m]=[]),t[m].push(I)}if(h.aggregates){for(let e=0;e<h.aggregates.length;e++){if(d=h.aggregates[e],"string"==typeof d&&!se[d]||"object"==typeof d&&!(d.name&&d.init&&d.add&&d.get))throw new Error(`Field '${o}' has invalid aggregate`);u=d.name||d,p[u]||a.push(u),p[u]=1}r[o]=1}}var I,m;_.length>0&&(A._externalItems$=l(_.map((e=>"#"+n.escapeCSS(e))).join(",")),A._externalItems$.on("change",y),A._externalItemsHandler=y)}(K.fields,A._dependentFields,A._calculatedFields,A._aggregatedFields,A._aggregateRecs),A._staleAggFields=[],A._debouncedUpdateAggregates=n.debounce((function(){A._updateAggregates()}),250),K.identityField)if(C(K.identityField)){A._identityKeys=[];for(let e=0;e<K.identityField.length;e++){if(A._identityKeys.push(A.getFieldKey(K.identityField[e])),void 0===A._identityKeys[e])throw ee("Identity",K.identityField[e]);W(K.identityField[e],"identity")}}else{if(A._identityKeys=[A.getFieldKey(K.identityField)],void 0===A._identityKeys[0])throw ee("Identity",K.identityField);W(K.identityField,"identity")}if(K.typeField){if(A._typeKey=A.getFieldKey(K.typeField),void 0===A._typeKey)throw ee("Type",K.typeField);W(K.typeField,"type")}if(K.childrenField){if(A._childrenKey=A.getFieldKey(K.childrenField),void 0===A._childrenKey)throw ee("Children",K.childrenField);W(K.childrenField,"children")}if(K.parentIdentityField){if(A._parentIdKey=A.getFieldKey(K.parentIdentityField),void 0===A._parentIdKey)throw ee("Parent identity",K.parentIdentityField);W(K.parentIdentityField,"parentIdentity")}if(K.sequenceField){if(A._sequenceKey=A.getFieldKey(K.sequenceField),void 0===A._sequenceKey)throw ee("Sequence",K.sequenceField);W(K.sequenceField,"sequence")}if(K.metaField){if(A._metaKey=A.getFieldKey(K.metaField),void 0===A._metaKey)throw ee("Meta",K.metaField);W(K.metaField,"meta")}if(K.shape!==o?K.identityField?A.getRecord=A._getRecordById:K.shape===a?A.getRecord=A.recordAt:A.getRecord=function(){return null}:A.getRecord=function(){return A._data},A._index=new Map,A._selection=new Map,A._clear(),h?(P=K.paginationType!==v&&(null!=m?m:null==u||h.length<u),A._addData(0,0,h,u,P,x)):(null!=u&&(A._totalRecords=u),K.shape===o&&!1===m&&(A._haveAllData=!0)),K.parentModel&&K.parentRecordId&&!h&&(U=e.get(K.parentModel),U)){z=U.getRecordMetadata(K.parentRecordId),z.inserted&&(A._masterRecordIsInserted=!0,A._clear()),z.deleted&&(A._saveDataState(),A._masterRecordIsDeleted=!0,A._clear(),A._addData(0,0,[],0,!1,!1)),O=A._parentFieldsMap={};for(let e in K.fields)M(K.fields,e)&&(k=K.fields[e],k.parentField&&(O[k.parentField]||(O[k.parentField]=[]),O[k.parentField].push(e)));A.parentModelViewId=U.subscribe({onChange:function(t,i){let n;if(t===_||t===f||t===g||t===p){n=i.recordIds||i.deletedIds;for(let s=0;s<n.length;s++)if(n[s]===K.parentRecordId){if(t===_)A._saveDataState(),A._masterRecordIsDeleted=!0,A._clear(),A._addData(0,0,[],0,!1,!1),j(A,c,{});else if(t!==f&&t!==g||!A._masterRecordIsDeleted)if(t===g&&i.newIds&&i.newIds[A.instance]){const t=i.newIds[A.instance];let n=[];K.parentRecordId=t,e.renameInstance(A.modelId(),t),A.forEach(((e,t,i)=>{let s=A.getRecordMetadata(i);s.autoInserted&&!s.updated&&n.push(s.record)})),n.length&&A.deleteRecords(n)}else t===p&&A._masterRecordIsDeleted&&delete A._saveState;else delete A._masterRecordIsDeleted,A._restoreDataState(),j(A,c,{});break}t===p&&A._masterRecordIsInserted&&delete A._masterRecordIsInserted}else t===y&&(i.oldIdentity||i.recordId)===K.parentRecordId?(E=i.field,E in O&&(T=O[E],V=U.getValue(i.record,E),A.forEach((function(e){let t;if(!A._metaKey||!e[A._metaKey].agg)for(let n=0;n<T.length;n++)t=T[n],i.oldValue===A.getValue(e,t)&&A.setValue(e,t,V)}))),i.oldIdentity&&(K.parentRecordId=i.recordId,e.renameInstance(A.modelId(),i.recordId))):t===c&&A._masterRecordIsDeleted?(delete A._masterRecordIsDeleted,A._restoreDataState(),j(A,c,{})):t===I&&(K.parentModel=null,A.parentModelViewId=null,delete A._masterRecordIsDeleted,delete A._masterRecordIsInserted)},progressView:"m:"+t}),e.release(K.parentModel)}return w.length>=b&&(N=function(){for(let e=0;e<w.length;e++){let t=w[e];if(!t.isChanged())return t}return null}(),N&&(i.info("Model: cache overflow; remove model from cache: "+N.modelId()),e.destroy(q(N.modelId())))),N=R[F[0]],N||(N={instances:{},instancesRef:{}},R[F[0]]=N),F[1]?(N.instances[F[1]]&&(e.destroy(F),R[F[0]]=N),N.instancesRef[F[1]]=1,N.instances[F[1]]=A):(N.model&&(e.destroy(F),R[F[0]]=N),N.modelRef=1,N.model=A),i.info("Model: created model: "+t+" refCount: 1"),A},e.list=function(e,t,i){return he(null,i,e,t).map((e=>e.id))},e._resetTempIds=function(){V.clear()},e._getStats=function(){let e,t,i=[];for(let n in R)if(M(R,n)){const s=R[n],r=s.model;for(t in r&&(e={name:r.name,instance:null,refCount:s.modelRef,cachePos:w.indexOf(r),subscribers:r._listeners.length,progressViews:r._listeners.map((function(e){return e.progressView||null}))},i.push(e)),s.instances)if(M(s.instances,t)){const n=s.instances[t];e={name:n.name,instance:n.instance,refCount:s.instancesRef[t],cachePos:w.indexOf(n),subscribers:n._listeners.length,progressViews:n._listeners.map((function(e){return e.progressView||null}))},i.push(e)}}return i},e.anyChanges=function(e,t,i){return he("change",i,e,t).length>0},e.anyErrors=function(e,t,i){return he("error",i,e,t).length>0},e.addChangesToSaveRequest=function(e,t,i){let n=[],s=he("change",i,!1,t);if(s.length<=0)return null;for(let t=0;t<s.length;t++){let i=s[t].model.addChangesToSaveRequest(e);i&&n.push(i)}return function(e){for(let t=0;t<n.length;t++)n[t](e)}},e.save=function(e,i,n,s,r){let l,a,d,o;if(e=e||{},i=i||{},d=he("change",s,!1,n),l=apex.model.addChangesToSaveRequest(e,n,s),l){if(n&&void 0===i.loadingIndicator&&void 0===i.loadingIndicatorPosition){o=[];for(let e=1;e<d.length;e++)o.push(d[e].model);i.loadingIndicator=$(d[0].model,o)}return a=(r||t.plugin)(e,i),l(a),a}return null},e.multipleFetch=function(e,i,n,s){let r,l=[];if(e=e||{},i=i||{},n.forEach((t=>{let i,n=he(null,!1,!1,t);n.length>0&&(i=n[0].model._addToFetchRequest(e,0),i&&l.push(i))})),l.length>0){r=(s||t.plugin)(e,i);for(let e=0;e<l.length;e++)l[e](r);return r}return null},e.equalModelIds=function(e,t){return"string"==typeof e&&"string"==typeof t?e===t:!(!C(e)||!C(t)||2!==e.length||2!==t.length)&&n.arrayEqual(e,t)},e.get=function(e){const t=q(e),n=R[t[0]];let s,r;return n&&(t[1]?(s=n.instances[t[1]],s&&(r=n.instancesRef[t[1]]+=1)):(s=n.model,s&&(r=n.modelRef+=1)),s&&(ce(s),i.info("Model: get model: "+e+" refCount: "+r))),s},e.renameInstance=function(e,t){const n=q(e),s=n[0],r=n[1],l=R[s];if(l&&r){let e,n=l.instances[r];l.instances[t]&&i.error("Model: Error rename model to one that already exists.",t),n.instance=t,e=l.instancesRef[r],delete l.instances[r],delete l.instancesRef[r],l.instances[t]=n,l.instancesRef[t]=e,i.info("Model: rename model "+s+" instance: "+r+" to "+t),j(n,"instanceRename",{oldInstance:r,newInstance:t})}},e.release=function(t){const n=q(t);let s,r=R[n[0]];r&&(n[1]?r.instancesRef[n[1]]?(s=r.instancesRef[n[1]]-=1,r=r.instances[n[1]]):r=null:(s=r.modelRef-=1,r=r.model),r&&(i.info("Model: release model: "+t+" refCount: "+s),s<=0&&(r._options.parentModel&&oe(r._options.parentModel)?(i.info("Model: save in cache model: "+t),function(e){let t=w.indexOf(e);t>=0&&w.splice(t,1),w.push(e)}(r)):r.isChanged()||e.destroy(n))))},e.destroy=function(t){const n=q(t);let s,r=R[n[0]];function l(n){if(n){if(ce(n),n.parentModelViewId){let t=n._options.parentModel,i=e.get(t);i&&(i.unSubscribe(n.parentModelViewId),n.parentModelViewId=null,e.release(t))}n._externalItems$&&n._externalItems$.off("change",n._externalItemsHandler),j(n,I,{}),n._data=null,n._index=null,n._selection=null,n._destroyed=!0,i.info("Model: destroy model: "+t)}}if(r){if(n[1])l(r.instances[n[1]]),delete r.instancesRef[n[1]],delete r.instances[n[1]];else if(l(r.model),delete r.model,delete r.modelRef,"string"==typeof t&&!n[1])for(s in r.instances)M(r.instances,s)&&(l(r.instances[s]),delete r.instancesRef[s],delete r.instances[s]);0!==Object.keys(r.instances).length||r.model||delete R[n[0]]}},e.getMaxCachedModels=function(){return b},e.setMaxCachedModels=function(e){b=parseInt(e,10)||10};const ue=new Map,fe=apex.WebComponent,ge={modelId:{type:fe.dataTypes.string},recordId:{type:fe.dataTypes.string,default:""},explicitStore:{type:fe.dataTypes.boolean,default:!1},syncWith:{type:fe.dataTypes.string,default:""}};fe._addHyphenCaseAttrNames(ge);const _e=fe._configObservedAttributes(ge),pe=class extends fe{#e=null;#t=null;#i=-1;#n=!1;#s=!1;#r=[];#l=null;#a=null;#d=null;#o=!1;#h=null;#c={modelId:null,recordId:null,explicitStore:null,syncWith:null};constructor(){super(),this._configPrivateState(this.#c);let e=this;this.#h=apex.actions.createContext("modelCursor",this),this.#h.add([{name:"cursor-next",action:function(){e.nextRecord()}},{name:"cursor-previous",action:function(){e.previousRecord()}}])}getModel(){return this.#e}getCurrentRecord(){return this.#t}firstRecord(){let e;if(this.#n){if(e=this.#e.getRecord(),e)return this.recordId=this.#e.getRecordId(e),!0}else if(this.#s);else if(e=this.#e.recordAt(0),e)return this.recordId=this.#e.getRecordId(e),this.#i=0,!0;return!1}nextRecord(){if(this.#n)return!1;let e,t=this.#i;if(this.#s);else if(t<0&&this.#t&&(this.#i=t=this.#e.indexOf(this.#t)),t>=0&&(t+=1,e=this.#e.recordAt(t),e))return this.recordId=this.#e.getRecordId(e),this.#i=t,!0;return!1}previousRecord(){if(this.#n)return!1;let e,t=this.#i;if(this.#s);else if(t<0&&this.#t&&(this.#i=t=this.#e.indexOf(this.#t)),t>=0){if(t-=1,t<0)return!1;if(e=this.#e.recordAt(t),e)return this.recordId=this.#e.getRecordId(e),this.#i=t,!0}return!1}lastRecord(){let e,t=0;if(this.#n){if(e=this.#e.getRecord(),e)return this.recordId=this.#e.getRecordId(e),!0}else if(this.#s);else{let i=this.#e.getTotalRecords(!0);if(i>0&&(t=i-1),e=this.#e.recordAt(t),e)return this.recordId=this.#e.getRecordId(e),this.#i=t,!0}return!1}store(){l(this).trigger("apexbindstore")}subscribe(e,t,i){this.#r.push({field:t,recordId:e,notify:i})}unsubscribe(e,t,i){let n=this.#r.findIndex((n=>n.notify===i&&n.recordId===e&&n.field===t));return n>=0&&this.#r.splice(n,1),0===this.#r.length}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),"model-id"===e){let e=this.#c.modelId;if(e.startsWith("[")&&e.endsWith("]"))try{e=JSON.parse(e),C(e)&&2===e.length||(e=null)}catch(t){e=null}this.#u(e)}else if("record-id"===e)t!==i&&this.#f(this.#c.recordId);else if("sync-with"===e&&t!==i){let e=apex.region(i),t=this;this.#d&&this.#d.off("interactivegridselectionchange.ig"),e&&"InteractiveGrid"===e.type&&(this.#d=e,e.on("interactivegridselectionchange.ig",n.debounce(((e,i)=>{const n=i.selectedRecords[0];n&&(t.#o=!0,t.recordId=i.model.getRecordId(n))}),100)))}}#u(t){let s=!0,r=!1;const l=(e,t)=>{if(e===c)0===this.#e._data.length&&(this.#t=null);else if(e===I)this.modelId="";else if(e===u){let e=this.#i;this.#f(this.#c.recordId),e>0&&null!==this.#t&&(this.#i=this.#e.indexOf(this.#t))}else if(e===g||e===f)for(let e=0;e<t.recordIds.length;e++){let i=t.recordIds[e];i===this.#c.recordId&&(this.#t=t.records[e]),this.#g(i,null)}else"move"===e||e===p||t.recordIds||"set"!==e&&"metaChange"!==e||this.#g(t.recordId,t.field)};this.#e&&(this.#e.unSubscribe(this.#l),s=C(this.#a)&&C(t)?!n.arrayEqual(this.#a,t):this.#a!==t,s&&(e.release(this.#a),this.#e=null,this.#t=null,r=!0));let a=this.recordId;if(t){s&&(this.#e=e.get(t),this.#e?this.#a=t:(this.#a=null,i.error("Model not found: ",this.#c.modelId)));let n=this.#e,a=n.getOption("shape");if(this.#n=a===o,this.#s=a===d,this.#l=n.subscribe({onChange:l}),r&&this.#c.recordId){let e=this.#n?n.getRecord():n.recordAt(0);e?(this.recordId=n.getRecordId(e),this.#i=0):this.recordId=""}else if(this.#n){let e="";n.getOption("identityField")&&(e=n.getRecordId(n.getRecord())),this.recordId=e}}else r&&this.#c.recordId&&(this.recordId="");this.#c.recordId===a&&this.#f(this.#c.recordId)}#g(e,t){const i=this.#r,n=this.#n;for(let s=0;s<i.length;s++){let r=i[s],l=r.recordId;l||n||(l=this.#c.recordId),!n&&e&&l!==e||t&&r.field!==t||r.notify()}}#f(e){(e||this.#n)&&this.#e?this.#t=this.#e.getRecord(e):this.#t=null,this.#i=-1,this.#g(null,null),this.#d&&(this.#o||this.#d.call("setSelectedRecords",[this.#t],!1,!1),this.#o=!1)}static get observedAttributes(){return _e}static get componentMetaData(){return ge}};apex.gPageContext$.on("apexreadyend",(()=>{customElements.define("a-model-cursor",pe)})),apex.binding.addDataRefType("model",{priority:10,subscribe:function(e,t){if(!e.field||!(e.cursor&&!e.modelId||!e.cursor&&e.modelId&&"string"==typeof e.modelId))return void i.error("Invalid model data reference: ",e);let s=e.cursor;if(!s){const t=e.modelId;if(s=ue.get(t),!s){let e=l(`<a-model-cursor model-id="${n.escapeHTMLAttr(t)}" style="display:none;"></a-model-cursor>`);e.appendTo("body"),s=e[0],ue.set(t,s)}}s.subscribe(e.recordId||null,e.field,t)},unsubscribe:function(e,t){let i=e.modelId,n=i?null:e.cursor;n||(n=ue.get(i)),n&&n.unsubscribe(e.recordId||null,e.field,t)&&i&&(ue.delete(i),l(n).remove())},_getCursorFromRef:function(e){let t=e.cursor;return t||(t=ue.get(e.modelId)),t||null},getValue:function(e){const t=this._getCursorFromRef(e),i=t?.getModel();if(!i)return"";let n,s="";return n=e.recordId?i.getRecord(e.recordId):t.getCurrentRecord(),n&&(s=i.getValue(n,e.field)),s},setValue:function(e,t,n,s,r){const l=this._getCursorFromRef(e),a=l?.getModel(),d=e.field;if(!a)return void i.warn("setValue no model",e);let o,h;if("record"!==a.getOption("shape")?(h=e.recordId||e.cursor.recordId,o=a.getRecord(h)):o=a.getRecord(),o){let e,i=a.getValue(o,d);if(null!==i&&"object"==typeof i&&M(i,"v")&&(t={v:t,d:n}),e=a.setValue(o,d,t),"DUP"===e);else{let e=a.getRecordId(o);s.valid?a.setValidity("valid",e,d):a.setValidity("error",e,d,r)}}},parse:function(e,t){let i,n=l(t).closest("[data-bind-model],[data-bind-cursor],a-model-cursor"),s=l(t).closest("[data-bind-record],.a-GV-row[data-id]"),r=s.attr("data-bind-record")||s.attr("data-id"),a=null;return n[0]?(i=n.attr("data-bind-cursor"),i&&(n=l("#"+i)),n.is("a-model-cursor")&&(i=n[0]),a={type:"model",field:e},i?a.cursor=i:a.modelId=n.attr("data-bind-model"),r&&(a.recordId=r),a):a}})}(apex.model,apex.server,apex.debug,apex.util,apex.item,apex.locale,apex.jQuery);
!function(t,e,i,s,o,l){"use strict";const a="a-GV",n="noDataMsg",r="moreDataMsg",h="altMessage",d=h+"-text",c=h+"-icon",g="footer",f="-hideDeleted",p="js-ScrollFiller",u="."+p,m="controlBreak",_="is-selected",R="."+_,P=".is-aggregate",S="aria-labelledby",v="aria-label",C="aria-current",k="aria-controls",I="aria-hidden",$="js-tabbable",O="."+$,T="js-rangeDisplay",w="."+T,y=":tabbable",A=":visible",D="data-start",b="data-end",M="data-id",x="data-rownum",F="data-state",E="data-page",H="class",L="disabled",z="role",N="region",j=".js-pg-prev,.js-pg-next,.js-pg-first,.js-pg-last",B="APEX.GV.",V="true",G="before",W="after",U="pageChange",K=t.hasOwnProperty,q=Object.entries,X=t.applyTemplate,Y=Array.isArray,Q=t=>parseInt(t,10);let Z=new Map;function J(t){return s.getMessage(B+t)}function tt(t,...e){return s.formatMessage(B+t,...e)}function et(t,...e){return s.formatMessageNoEscape(B+t,...e)}function it(t,e){return Math.floor(t/e)*e}function st(t,e,i,s,o){let l=Math.ceil((i+1-e)/s)*o;t.css("height",l)}function ot(e,i){const s=i.cssClassPrefix||a;return t.escapeHTMLAttr(s+"-"+e)}function lt(t,e){return"."+ot(t,e)}function at(t,e,i){t.find(u).each((function(){let t=l(this),s=Q(t.attr(D)),o=Q(t.attr(b));st(t,s,o,e,i)}))}function nt(t){return"collapse"!==t.css("visibility")}function rt(t,e){t.css("visibility",e?"":"collapse").toggleClass("is-hidden",!e)}function ht(t){return t.getOption("hasTotalRecords")}l.widget("apex.tableModelViewBase",{widgetEventPrefix:"tableModelViewBase",options:{modelName:null,progressOptions:null,noDataMessage:"",selectionStatusMessageKey:"APEX.TMV.SELECTION_COUNT",entityTitleSingular:null,entityTitlePlural:null,cssClassPrefix:"",noDataIcon:"icon-irr-no-results",moreDataMessage:"",editable:!1,autoAddRecord:!1,hideDeletedRows:!1,hasSize:!1,footer:!0,fixedRowHeight:!0,showNullAs:"-",applyTemplateOptions:{},stickyTop:!1,stickyFooter:!1,hideEmptyFooter:!1,pagination:{scroll:!1,virtual:!1,loadMore:!1,showPageLinks:!1,maxLinks:5,showPageSelector:!1,showRange:!0,firstAndLastButtons:!1,hideSinglePage:!1},persistSelection:!1,loadIncompleteSelection:"on-demand",highlights:{},highlighter:null,highlighterContext:null,rowsPerPage:null,scrollParentOverride:null,updateStatus:null},firstPage:function(){let t;return!this.renderInProgress&&(this.options.pagination.scroll?(t=this.scrollParent$,t.scrollTop(this.scrollDelta)):this.pageOffset>0&&(this.pageOffset=0,this.refresh(!1)),!0)},previousPage:function(){let t,e;return!this.renderInProgress&&(this.options.pagination.scroll?(t=this.scrollParent$,e=t.scrollTop()-this.scrollDelta-this.viewportHeight,e<0&&(e=0),t.scrollTop(e+this.scrollDelta)):this.pageOffset>0&&(this.pageOffset-=this.pageSize,this.pageOffset<0&&(this.pageOffset=0),this.refresh(!1)),!0)},nextPage:function(){let t,e,i,s;return!this.renderInProgress&&(this.options.pagination.scroll?(t=this.scrollParent$,e=this._getDataContainer().first().height()-this.viewportHeight,i=t.scrollTop()-this.scrollDelta+this.viewportHeight,i>e&&(i=e),t.scrollTop(i+this.scrollDelta)):(s=this.model.getTotalRecords(),(s<0||this.pageOffset+this.pageCount<s)&&(this.pageOffset+=this.pageSize,this.refresh(!1))),!0)},lastPage:function(){let t,e,i,s;return!this.renderInProgress&&(this.options.pagination.scroll?(e=this.scrollParent$,i=this._getDataContainer().first().height()-this.viewportHeight,e.scrollTop(i+this.scrollDelta)):(s=this.model.getTotalRecords(),s>0&&this.pageOffset+this.pageCount<s&&(t=Math.ceil(s/this.pageSize),this.pageOffset=(t-1)*this.pageSize,this.refresh(!1))),!0)},loadMore:function(){return this.options.pagination.scroll&&!this._scrollHandler?this._addNextPage():this.nextPage()},fetchAllData:function(t=!0){if(this.fetchAllDataActive)return;let e,i=this.options.persistSelection&&ht(this.model);i&&(e=this._selectedCount()),this.fetchAllDataActive=!0,this.model.fetchAll((t=>{this._updateStatus(),t.done&&(i&&this._checkSelectionChange(e),this.fetchAllDataActive=!1)}),!t)},getPageInfo:function(){let e=null,i=ht(this.model),s=this.options.pagination,o=this.model.getTotalRecords(),a=this.model.getServerTotalRecords();if(!this.noData)if(e={rowHeight:this.avgRowHeight,recordsPerRow:this._getRecordsPerRow(),firstOffset:this.pageFirstOffset||null,lastOffset:this.pageLastOffset||null,pageSize:this.pageSize,pageOffset:this.pageOffset},i&&(e.total=a),s.scroll){const i=this._getDataContainer();let s,o,a=this.scrollParent$[0]===window,n="TBODY"===i[0].nodeName,r="grid"===i.attr(z),h=i.children().not(P);e.scrollOffset=this.scrollParent$.scrollTop(),s=t.binarySearch(h,e.scrollOffset,((t,i)=>{let s=l(i),o=a?s.offset().top:s.position().top;return a||n||s.offsetParent().closest(this.scrollParent$).length>0||(o+=e.scrollOffset),t-o})),o=h.eq(s),r&&(o=o.children().first()),e.viewOffset=Q(o.attr(x))-1}else e.currentPage=Math.floor(this.pageOffset/this.pageSize),o>=0&&(e.totalPages=Math.ceil(o/this.pageSize));return e},gotoPage:function(t){let e,i=this.model.getTotalRecords();return!this.renderInProgress&&(i>0&&(e=Math.ceil(i/this.pageSize),t>=0&&t<e&&(this.pageOffset=t*this.pageSize,this.refresh(!1))),!0)},getActiveRecordId:function(){return this.activeRecordId},getActiveRecord:function(){return this.activeRecord},getModel:function(){return this.model},setActiveRecordValue:function(t){const e=this.columnItems[t];this.activeRecord&&e&&(this.ignoreItemChange=!0,this._setModelValue(null,e.item,this.activeRecord,t,!0),this.ignoreItemChange=!1)},lockActive:function(){this.activeRecord&&(this.activeLockCount+=1)},unlockActive:function(){this.activeRecord&&(this.activeLockCount-=1,this.activeLockCount<0&&(this.activeLockCount=0),0===this.activeLockCount&&(this.activeUnlockCallback&&(this.activeUnlockCallback(),this.activeUnlockCallback=null),this.finishEditingCallback&&(this.finishEditingCallback(),this.finishEditingCallback=null)))},finishEditing:function(){const t=this,e=l.Deferred();function i(){t._finishEditing?t._finishEditing(e):e.resolve()}return this.activeLockCount>0?this.finishEditingCallback=i:i(),e.promise()},addStateIcon:function(e,i,s){const o=t.htmlBuilder();this.stateIconMessages[e]=s,0===this._findStateIcon(e).length&&(o.markup("<span role='img'").attr(H,i).attr(F,e).attr(v,s||e).markup("></span>"),this.stateIcons$.append(o.toString()))},removeStateIcon:function(t){this._findStateIcon(t).remove(),delete this.stateIconMessages[t]},_create:function(){const t=this.options;t.hideDeletedRows&&this.element.addClass(ot(f,t)),this.noData=!0,this.pendingRefresh=null,this.renderInProgress=!1,this._refreshNeeded=!1,this.pageOffset=0,this.highWaterMark=0,this.pageCount=0,this.totalRenderedRecords=0,this.pageSize=10,this.onLastPage=!1,this.lastScrollLeft=null,this.lastScrollTop=null,this.scrollPageTimer=null,this.hasScrollFillers=!1,this._scrollHandler=null,this.stateIconMessages={},this.prevSelCount=0,this.ignoreFieldChange=null,this.reinitCallbacks=null,this.activeRecord=null,this.activeRecordId=null,this.activeLockCount=0,this.activeUnlockCallback=null,this.columnItems=null,this.columnItemsContainer$=null,t.progressOptions||(t.progressOptions={fixed:!t.hasSize}),t.pagination.scroll&&!t.pagination.loadMore&&(t.rowsPerPage=null),t.rowsPerPage&&(this.pageSize=t.rowsPerPage),this._setOption("applyTemplateOptions",t.applyTemplateOptions)},_tableModelViewDestroy:function(){this.footer$&&(this.footer$.remove(),this.footer$=null),this.pageRange$=null,this.pageSelector$=null,this.status$=null,this.stateIcons$=null,this.element.removeClass(ot(f,this.options)),this._removeScrollHandler()},_refreshCheckIfVisible:function(){return null===this.element[0].offsetParent?(this.pendingRefresh=!0,!1):(this.pendingRefresh=!1,!0)},_initModel:function(i,s){const o=this.options,l=this;let a,n=!0;if(this.model&&(this.model.unSubscribe(this.modelViewId),n=Y(this.modelName)&&Y(i)?!t.arrayEqual(this.modelName,i):this.modelName!==i,n&&(e.release(this.modelName),this.model=null,this.modelName=null)),this.modelChanged=n,i){if(n&&(this.modelName=i,this.model=e.get(i),!this.model))throw new Error("Model not found: "+i);this.modelViewId=this.model.subscribe({onChange:s||function(t,e){let i,s,n,r,h,d,c,g,f,p,u=!1;if(!l.pendingRefresh){if("refresh"===t)l.pageOffset=0,l.highWaterMark=0,l.pageCount=0,l.refresh();else if("refreshRecords"===t||"revert"===t){i=l._elementsFromRecordIds(e.recordIds);for(let t=0;t<i.length;t++)s=i[t],s&&(n=e.records[t],h=e.recordIds[t],r=e.newIds[h]||h,d=l.model.getRecordMetadata(r),l._replaceRecord(s,n,h,r,d));"refreshRecords"===t&&!o.pagination.scroll&&Object.keys(e.newIds).length>0&&(u=!0)}else if("move"===t){f=e.records,e.insertAfterId&&(i=l._elementsFromRecordIds([e.insertAfterId]),s=i.length>0?i[0]:null);for(let t=f.length-1;t>=0;t--)n=f[t],r=l.model.getRecordId(n),d=l.model.getRecordMetadata(r),i=l._elementsFromRecordIds([r]),i.length>0&&i[0]&&l._removeRecord(i[0]),c=l._insertRecord(s,n,r,d,s?W:G)}else if("insert"===t||"copy"===t)if("insert"===t?(p=!1,f=[e.record]):(p=!0,f=e.records),e.insertAfterId&&(i=l._elementsFromRecordIds([e.insertAfterId]),s=i.length>0?i[0]:null),l.noData)setTimeout((function(){l.refresh(),i=l._elementsFromRecordIds([l.model.getRecordId(f[0])]),i.length>0&&i[0]&&l._afterInsert(i,p)}),1);else{g=[];for(let t=f.length-1;t>=0;t--)n=f[t],r=l.model.getRecordId(n),d=l.model.getRecordMetadata(r),c=l._insertRecord(s,n,r,d,s?W:G),g.unshift(c);l._afterInsert(g,p)}else if("clearChanges"===t){if(a){i=l._elementsFromRecordIds(e.deletedIds);for(let t=0;t<i.length;t++)i[t]&&l._removeRecord(i[t]);e.deletedIds.length>0&&!o.pagination.scroll&&(u=!0)}i=l._elementsFromRecordIds(e.changedIds);for(let t=0;t<i.length;t++)s=i[t],s&&(r=e.changedIds[t],d=l.model.getRecordMetadata(r),n=l.model.getRecord(r),l._updateRecordState(s,r,n,d))}else if(e.recordIds){i=l._elementsFromRecordIds(e.recordIds);for(let h=0;h<i.length;h++)s=i[h],s&&(r=e.recordIds[h],d=l.model.getRecordMetadata(r),n=e.records[h],"delete"===t?(!o.hideDeletedRows&&a&&null!==d||l._removeFocus(s),a&&null!==d?l._updateRecordState(s,r,n,d):l._removeRecord(s)):l._updateRecordState(s,r,n,d));"delete"===t&&(0===l.model.getTotalRecords()?u=!0:a||o.pagination.scroll?o.hideDeletedRows&&(l._deletedRowsHidden(),l._updateStatus()):u=!0)}else if("set"===t||"metaChange"===t){if(null===l.ignoreFieldChange||l.ignoreFieldChange!==e.field){let s=e.property;n=e.record,r=l.model.getRecordId(n),e.oldIdentity&&l._identityChanged(e.oldIdentity,r),d=l.model.getRecordMetadata(r),i=l._elementsFromRecordIds([r]),i.length>0&&i[0]&&("set"===t&&l._updateRecordField(i[0],n,e.field,d),l._updateRecordState(i[0],r,n,d,s))}}else"instanceRename"===t&&l.modelName[1]===e.oldInstance&&(l.modelName[1]=e.newInstance);u?l._refreshNeeded||(l._refreshNeeded=!0,queueMicrotask((()=>{l.refresh(),l._refreshNeeded=!1}))):"refresh"!==t&&l._updateTotalRecords()}},progressView:this.element,progressOptions:o.progressOptions}),a=this.model.getOption("onlyMarkForDelete"),this.options.pagination.scroll&&this.scrollParent$&&this.scrollParent$.scrollTop()>this.scrollDelta&&this.scrollParent$.scrollTop(this.scrollDelta),this.pageOffset=0,this.highWaterMark=0,this.pageCount=0}},_renderButton:function(t,e,i,s,o){t.markup(`<button class='${e}' type='button'`).attr(v,s).attr("title",s).optionalAttr("aria-expanded",null==o?null:o?V:"false").markup("><span aria-hidden='true' class='a-Icon ").attr(i).markup("'></span></button>")},_renderAltDataMessages:function(t,e){const i=this.options;function o(s,o,l,a,n,r){t.markup(`<div class='${s} ${ot(h,i)}' style='display:none;' `).optionalAttr(z,n).optionalAttr(v,r).markup(`><div class='${ot(c,i)}' `).optionalAttr(z,r?"img":null).optionalAttr(v,r).optionalAttr(I,r?null:V).markup(`><span class='a-Icon ${l}'></span></div>`).markup(`<div role='status'><span class='${ot(d,i)}'`).optionalAttr("id",e?e+o+"_msg":null).markup(`>${a}</span></div></div>`)}o(ot(n,i),"_no",i.noDataIcon,i.noDataMessage,"region",s.getMessage("APEX.IG.NO_DATA_FOUND")),o(ot(r,i),"_more","icon-warning",i.moreDataMessage)},_renderLoadMore:function(t){const e=this.options,i=e.pagination;i.scroll&&i.loadMore&&t.markup(`<div class="${ot("loadMore",e)}"><button type="button" class="a-Button js-load ${ot("loadMoreButton",e)}">`).content(J("LOAD_MORE")).markup("</button></div>")},_renderFooter:function(t,e){const i=this.options;function s(){let s=i.entityTitlePlural?et("PAGE_RANGE_ENTITY",i.entityTitlePlural):J("PAGE_RANGE");t.markup("<span ").attr(H,T).optionalAttr("id",e?e+"_pageRange":null).attr("title",s).markup(`><span class="${ot("pageRange",i)} "></span></span>`)}if(i.footer){if(t.markup(`<div class="${ot(g,i)}" style="display:none;" `).attr(z,N).attr(v,J("FOOTER_LANDMARK")).markup(`><div class="${ot("stateIcons",i)}" `).attr(z,N).attr(v,J("STATE_ICONS_LANDMARK")).markup("></div><div ").attr(z,N).attr(v,J("STATUS_LANDMARK")).markup("><div ").optionalAttr("id",e?e+"_status":null).attr(H,ot("status",i)).attr(z,"status").markup(`></div></div><div class="${ot("pagination",i)}" `).optionalAttr(z,i.pagination?N:null).optionalAttr(v,i.pagination?J("PAGINATION_LANDMARK"):null).markup(">"),i.pagination){const e=[ot("pageButton",i),ot("pageButton--nav",i),"a-Button"],o=ht(this.model);let l=!1;i.pagination.scroll||(o&&i.pagination.firstAndLastButtons&&this._renderButton(t,e.join(" ")+" js-pg-first","icon-first",J("FIRST_PAGE")),this._renderButton(t,e.join(" ")+" js-pg-prev","icon-prev",J("PREV_PAGE"))),o&&(i.pagination.showPageLinks||i.pagination.showPageSelector)?t.markup(`<span class="${ot("pageSelector",i)}"></span>`):i.pagination.showRange&&(s(),l=!0),i.pagination.scroll||(this._renderButton(t,e.join(" ")+" js-pg-next","icon-next",J("NEXT_PAGE")),o&&i.pagination.firstAndLastButtons&&this._renderButton(t,e.join(" ")+" js-pg-last","icon-last",J("LAST_PAGE"))),!l&&i.pagination.showRange&&s()}t.markup("</div></div>")}},_refreshPagination:function(t){const e=this.options,i=e.pagination;this.hasScrollFillers=i.scroll&&i.virtual&&!i.loadMore,this.lastScrollTop=null,this.lastScrollLeft=null,t.length&&(e.hasSize||(t=e.scrollParentOverride?l(e.scrollParentOverride):l(window)),this.lastScrollLeft=t.scrollLeft(),this.lastScrollTop=t.scrollTop())},_paginationHasFocus:function(){const t=this.options,e=l(document.activeElement);if(e.closest(lt(g,t)).length>0){if(e.parent().hasClass(ot("pageSelector-item",t)))return e.parent().attr(E);{const t=/js-pg-\S+/.exec(e.attr(H));if(t)return"."+t[0]}}return!1},_restorePaginationFocus:function(t){if(t){let e,i=t;i>=0&&(i=`[${E}='${t}'] button`),e=this.footer$.find(i),e[0]&&e[0].disabled&&(e=this.footer$.find(":focusable").eq(0)),e.trigger("focus")}},_initPagination:function(t,e){const i=this.options,s=this.element,o=s.hasClass("u-RTL")?"right":"left",a=this.footer$=s.find(lt(g,i));if(this.pageKey=null,this.status$=a.find(lt("status",i)),this.stateIcons$=a.find(lt("stateIcons",i)),this.pageRange$=a.find(lt("pageRange",i)),this.pageSelector$=a.find(lt("pageSelector",i)),this.noData$=s.find(lt(n,i)),this.moreData$=s.find(lt(r,i)),l.ui.tooltip){let t=this.stateIconMessages;this.stateIcons$.tooltip({content:function(){let e=l(this).attr(F);return t[e]},items:`[${F}]`,show:apex.tooltipManager.defaultShowOption(),tooltipClass:ot("tooltip",i),position:{my:o+" bottom",at:o+" top-10",collision:"flipfit"}})}if(this._updateScrollHandler(e),i.pagination.scroll&&(this.pageOffset=0,this.highWaterMark=0,this.pageCount=0,this.totalRenderedRecords=0),!i.hasSize&&l.apex.stickyWidget){if(i.stickyTop){let e={stickToEnd:!0,toggleWidth:!0,bottom:()=>s.offset().top+s.outerHeight()-this._footerHeight()};"function"==typeof i.stickyTop&&(e.top=i.stickyTop),t.css("overflow","hidden").stickyWidget(e)}i.footer&&i.stickyFooter&&a.stickyWidget({isFooter:!0,toggleWidth:!0,stickToEnd:!0,top:()=>s.offset().top+this._getHeaderHeight()})}i.pagination.showPageLinks?this.pageSelector$.on("click",(t=>{let e=l(t.target).parent();e.length&&this.gotoPage(Q(e.attr(E))),t.preventDefault()})):i.pagination.showPageSelector&&this.pageSelector$.on("change",(t=>{this.gotoPage(Q(l(t.target).val()))})),a.find(".js-pg-first").on("click",(()=>{this.firstPage()})),a.find(".js-pg-prev").on("click",(()=>{this.previousPage()})),a.find(".js-pg-next").on("click",(()=>{this.nextPage()})),a.find(".js-pg-last").on("click",(()=>{this.lastPage()})),s.find(".js-load").on("click",(()=>{const t=this.scrollParent$.scrollTop();this.loadMore(),this.focus(),this.scrollParent$.scrollTop(t)})),a.on("click",".js-loadAll",(t=>{this.focus(),l(t.target).closest(".js-loadAll").remove(),this.fetchAllData()}))},_updateHeaderFooter(t){const e=this.options;!e.hasSize&&l.apex.stickyWidget&&(t[0]&&e.stickyTop&&t.stickyWidget("refresh"),this.footer$[0]&&e.stickyFooter&&this.footer$.stickyWidget("refresh"))},_footerHeight:function(){return this.footer$.outerHeight()||0},_addNextPage:function(){if(this.renderInProgress)return!1;let t=this.model.getTotalRecords();return(t<0||this.pageOffset+this.pageCount<t)&&(this.pageOffset+=this.pageCount,this._addPageOfRecords()),!0},_addPageOfRecords:function(t,e){const i=this,s=this.options,o=this._hasControlBreaks(),a=ht(this.model),n=lt(m,s);let r,d,c,g,f,_,R=this._getDataRenderContext();function S(t,e,i,s,o){return t>e||(i.attr(D,t),i.attr(b,e),st(i,t,e,s,o),!1)}function v(t,e,i,a){let r=a||0,h=i-e;return o&&(r=e+r,h=i,e=0,i+=t.filter(n).length),t.slice(e,i).filter(((t,e)=>{let i=l(e);return i.hasClass(ot(m,s))&&(t<r&&(r+=1),h+=1),i.hasClass(p)&&(h=t),t>=r&&t<h}))}function C(t,e,i){let o=e,l=g.find(`[${x}="${e+1}"]`);return(t&&!nt(t)||!l.is(A))&&(o=Q(l[i?"nextAll":"prevAll"](` ${lt("row",s)} [${x}]:visible`).first().attr(x))||0),o}if(!this.renderInProgress){if(f=i.noData$.parent().children().not(lt(h,s)),!this.noData&&!this.moreData$.is(A)||s.bodyTemplate||(this.noData$.hide(),this.moreData$.hide(),f.show(),this.resize()),g=i._getDataContainer(),0!==this.pageOffset&&s.pagination.scroll||(this.pageFirstOffset="",this.pageLastOffset=""),s.pagination.scroll||(this.totalRenderedRecords=0),this.controlBreakCollapsed=!!o&&null,o)if(0!==this.pageOffset&&s.pagination.scroll){let t=this.model.getOption("metaField");if(t){let e=this.pageOffset-1;for(;e>0;){let i,s=this.model.recordAt(e);if(s&&(i=this.model.getValue(s,t),!i.agg)){_=!0===i.endControlBreak;break}e-=1}}}else _=!0;r=0,d=this.pageSize,s.pagination.scroll?i.hasScrollFillers&&g.find(u).each((function(){let t=l(this),e=Q(t.attr(D)),s=Q(t.attr(b));if(i.pageOffset>=e&&i.pageOffset<s)return d=Math.min(d,s+1-i.pageOffset),!1})):this.pageOffset=it(this.pageOffset,d),c=this.pageOffset,this.renderInProgress=!0,this.model.forEachInPage(this.pageOffset,d,(function(h,m,k,I){if(h){let t,e,i=k?this.model.getRecordMetadata(k):{},s=i.serverOffset;o&&!i.agg&&(t=!0,_&&(_=!1,e=this._controlBreakLabel(h),this._renderBreakRecord(R,t,e,s)),i.endControlBreak&&(_=!0)),this._renderRecord(R,h,m,k,i),void 0!==s&&(s+=1,""===this.pageFirstOffset&&(this.pageFirstOffset=s),s>this.pageLastOffset&&(this.pageLastOffset=s)),r+=1}!e||0!==r&&r!==d&&h&&!I||this._getDataContainer().empty(),r!==d&&h&&!I||function(e){let o,h,d,m,_,k,I,$=i.avgRowHeight;if(i.pageCount=r,i.totalRenderedRecords+=r,i.pageOffset+r>i.highWaterMark&&(i.highWaterMark=i.pageOffset+r),0===i.pageOffset&&0===r)i.noData=!0,f.hide(),i.moreData$.hide(),i.noData$.show(),i._trigger(U,null,{offset:0,count:0}),s.autoAddRecord&&i.model.allowAdd()&&!e&&i._autoAddRecord();else{if(0===r)return i.renderInProgress=!1,void(s.pagination.scroll||(i.pageOffset-=i.pageSize,i.pageOffset<0&&(i.pageOffset=0),i._addPageOfRecords()));if(i.noData=!1,i.noData$.hide(),i.model.getDataOverflow()&&s.moreDataMessage?(i.moreData$.show(),f.hide()):(i.moreData$.hide(),f.show()),i.hasScrollFillers){o=g.find(u),d=i.model.getTotalRecords(!0)-1,_=d,0===o.length&&a?(h=i._getDataRenderContext(),i._renderFillerRecord(h,p),o=i._insertFiller(h,null),o.attr(D,0),o.attr(b,d),o=o.last()):0===o.last().next().length&&(_=Q(o.last().attr(b))),d!==_&&o.last().attr(b,d),m=i._getRecordsPerRow();let t=-1,e=!1;if(o.each((function(s){let o,a=!1,n=l(this),d=Q(n.last().attr(D)),g=Q(n.last().attr(b));if(c===d?(a=S(c+r,g,n,m,$),i._insertData(R,c,r,n,G),t=s,e=!0):c+r<g?(S(c+r,g,n,m,$),h=i._getDataRenderContext(),i._renderFillerRecord(h,p),o=i._insertFiller(h,n),S(d,c-1,o,m,$),i._insertData(R,c,r,n,G),t=s+1,e=!0):c<=g&&c+r>g&&(a=S(d,c-1,n,m,$),i._insertData(R,c,r,n,W),t=s+1,e=!0),e)return a&&(t===s&&(t=s+1),n.remove()),!1})),e||(i._insertData(R,c,r),t=o.length),i.totalRenderedRecords>8*i.pageSize){let e,l,a,r,c,f,_,R=0,O=null,T=0,w=0,y=!1;if(s.fixedRowHeight||(k=g.find(`[${x}="${i.pageOffset+1}"]`),k[0]&&(I=k.offset().top)),o=g.find(u),_=o.length-1,w>=t)w=-1,c=2*i.pageSize;else{for(O=o.eq(w);O.next().is(u);)O=O.next();c=Q(O.attr(b))}if(c>0&&(R=Math.abs(i.pageOffset-C(O,c+1,!0))),R>=3*i.pageSize)w>=0?(r=v(O.nextAll(),0,i.pageSize),T=r.not(n).length,a=r.first().is(A)&&r.last().is(A),f=r.last().next().filter(u),f.length&&a===nt(f)?(e=Q(O.attr(D)),l=Q(f.attr(b)),S(e,l,f,m,$),O.remove()):a===nt(O)?(e=Q(O.attr(D)),l=Q(O.attr(b))+T,S(e,l,O,m,$)):(e=Q(O.attr(b))+1,y=!0)):(e=c,l=e+i.pageSize,r=v(g.children(),e,l),T=r.not(n).length,a=r.first().is(A)&&r.last().is(A),y=!0),y&&(h=i._getDataRenderContext(),i._renderFillerRecord(h,p),O=i._insertFiller(h,r.eq(0)),S(e,e+T-1,O,m,$),rt(O,a));else{let s;if(R=0,_<t)_=-1,c=-1,s=g.children().not(P).last(),s.attr(M)&&(c=i.model.indexOf(i.model.getRecord(s.attr(M))),c=it(c,i.pageSize)-i.pageSize);else{for(O=o.eq(_);O.prev().is(u);)O=O.prev();c=Q(O.attr(D))}c>0&&(R=Math.abs(i.pageOffset+i.pageSize-C(O,c-1,!1))),R>=3*i.pageSize&&(_>=0?(r=v(O.prevAll(),0,i.pageSize),T=r.not(n).length,a=r.first().is(A)&&r.last().is(A),f=r.prev(u),f.length&&a===nt(f)?(e=Q(f.attr(D)),l=Q(O.attr(b)),S(e,l,f,m,$),O.remove()):a===nt(O)?(e=Q(O.attr(D))-T,l=Q(O.attr(b)),S(e,l,O,m,$)):(e=Q(O.attr(D))-T,l=e+T-1,y=!0)):(e=d-c,l=e+i.pageSize,r=v(s.prevAll(),0,l,e),T=r.not(n).length,T>0&&(a=r.first().is(A)&&r.last().is(A),y=!0,l=c-1,e=c-T)),y&&(h=i._getDataRenderContext(),i._renderFillerRecord(h,p),O=i._insertFiller(h,r.eq(0)),S(e,l,O,m,$),rt(O,a)))}T>0&&(r.remove(),i.totalRenderedRecords-=T)}if(!s.fixedRowHeight){let t=0;i._updateAvgRowHeight(),at(i._getDataContainer(),m,i.avgRowHeight),k&&k[0]&&(t=k.offset().top-I),0!==t&&i.scrollParent$.scrollTop(i.scrollParent$.scrollTop()+t)}}else i._insertData(R,c,r)}if(i._updateTotalRecords(),i.renderInProgress=!1,!i.noData&&s.pagination.scroll&&(i.controlBreakCollapsed||!a&&g.height()<i.scrollParent$.height())){let e=i.model.getTotalRecords(),s=i.hasScrollFillers?i.pageOffset+i.pageCount:i.highWaterMark;if(e<0||s<e){let e=!0;if(i.pageOffset=s,i.hasScrollFillers&&(e=!1,o=g.find(u),o.each((function(){if(i.pageOffset===Q(l(this).attr(D)))return e=!0,!1}))),e)return void i._addPageOfRecords(t)}}t&&t()}(I)}),this)}},_initPageSize:function(){let e,i,s,o,l=this.options,a=this._getRecordsPerRow();this.hasScrollFillers&&(this.recPerRow!==a&&at(this._getDataContainer(),a,this.avgRowHeight),this._scrollPage()),this.recPerRow=a,this._updateAvgRowHeight(),e=this.avgRowHeight,l.hasSize?i=this.scrollParent$[0].offsetHeight:(i=this.scrollParent$.height(),this.footer$.hasClass("js-stickyWidget-toggle")&&(i-=this._footerHeight()),o=this._getStickyTop(),o>0&&(i-=o+this._getHeaderHeight())),i-=t.getScrollbarSize().height,s=Math.floor(i/e),s<1&&(s=1),this.viewportHeight=s*e,l.rowsPerPage||(l.fixedRowHeight||l.pagination.scroll?(s*=a,l.pagination.scroll?(this.pageSize=Math.round(Math.max(20,1.5*s)),this.pageSize=Math.ceil(this.pageSize/a)*a):this.pageSize=s):this.pageSize=20)},_updateStatus:function(){const t=this.options,e=this._selectedCount(),i=ht(this.model)?this.model.getTotalRecords():null,s=this.model.getSelectionState().incomplete;let o=null,l="";this.prevSelCount=e,this.options.hideDeletedRows&&(o=this._deletedCount()),e>0&&(l+=this._selectedStatusMessage(e)),s&&!this.fetchAllDataActive&&("on-demand"===t.loadIncompleteSelection?l+=` <button type="button" class="a-Button a-Button--link js-loadAll"> ${J("LOAD_ALL")}</button> `:"always"===t.loadIncompleteSelection&&this.fetchAllData(!0)),o>0&&(l&&(l+=", "),l+=tt("DELETED_COUNT",o)+" "),this.status$.html(l),t.updateStatus&&t.updateStatus({deletedCount:o,selectedCount:e,total:i,incomplete:s})},_setModelValue:function(t,e,i,s,o){let l,a,n,r;if(t&&t.removeClass("is-active"),a=e.getValue(),o||(this.ignoreFieldChange=s),r=this.model.getRecordId(i),n=this.model.getValue(i,s),null!==n&&"object"==typeof n&&K(n,"v")&&(a={v:a,d:e.displayValueFor(a)}),l=this.model.setValue(i,s,a),"DUP"===l)this._setColumnItemValue(e,i,s),apex.message.alert(J("DUP_REC_ID"));else{let t=e.getValidity(),o=this.model.getRecordId(i);t.valid?this.model.setValidity("valid",o,s):this.model.setValidity("error",o,s,e.getValidationMessage()),o!==r&&this._identityChanged(r,o)}o||(this.ignoreFieldChange=null)},_initColumnItems:function(t){const e=this.options;let s=!0;this.columnItems={},this.columnItemsContainer$=null,this.asyncColumnItems=[];for(let i=0;i<t.length;i++){let l,a=t[i],n=a.elementId,r=null;n&&(Z.has(n)?(r=this.columnItems[a.property]=Z.get(n),l=r.item):(l=o(n),l.node&&(s=!1,r=this.columnItems[a.property]={element$:l.element.closest(lt("columnItem",e)),item:l},Z.set(n,r),l.whenReady&&this.asyncColumnItems.push(l.whenReady()))),r&&!this.columnItemsContainer$&&(this.columnItemsContainer$=r.element$.parent()))}this.columnItemsContainer$?s||this.columnItemsContainer$.find(y).addClass($).attr("tabindex",-1):this.editable&&i.error(`An editable ${this.widgetName} must have at least one column with a column item.`)},_waitForColumnItems:function(){return l.when(...this.asyncColumnItems)},_activateColumnItem:function(t,e){const i=t.element$;i.find(O).attr("tabindex",0).removeClass($),e&&(l("label[id='"+e+"']").length||("RADIO_GROUP"===t?.item?.item_type?i.find("[role='radiogroup']").attr(S,e):"CHECKBOX_GROUP"===t?.item?.item_type?i.find("[role='group']").attr(S,e):i.find(y).first().attr(S,e)))},_deactivateColumnItem:function(t){const e=t.element$,i=e.find(y);"RADIO_GROUP"===t?.item?.item_type?e.find("[role='radiogroup']").removeAttr(S):"CHECKBOX_GROUP"===t?.item?.item_type?e.find("[role='group']").removeAttr(S):i.first().removeAttr(S),this.columnItemsContainer$.append(e),i.addClass($).attr("tabindex",-1)},_renderFieldDataValue:function(e,i,s,o,l){const a=this.options;let n,r,h,d=null;(l&&l.url||i.linkTargetColumn)&&!o.agg&&(d=i.linkTargetColumn?this.model.getValue(s,i.linkTargetColumn)||null:l.url),n=this.model.getValue(s,i.property),(o.agg||o.inserted&&i.readonly)&&this.model.isIdentityField(i.property)&&(n=""),(i.linkText||i.linkAttributes||i.cellTemplate)&&(r=this.atOptions,r.model=this.model,r.record=s),d&&(e.markup("<a").attr("href",d),i.linkAttributes&&e.markup(X(i.linkAttributes,r)),e.markup(" tabindex='-1'>")),d&&i.linkText?e.markup(X(i.linkText,r)):i.cellTemplate?o.agg?(n=null==n?"":n,e.content(""+n)):(n=X(i.cellTemplate,r),a.highlighter&&(n=a.highlighter(a.highlighterContext,n,i)),e.markup(n)):null!==n&&""!==n||!(a.showNullAs||o.agg||d)?(null===n&&(n=""),"object"==typeof n&&K(n,"d")?n=n.d:(h=this.columnItems[i.property],h&&(n=h.item.displayValueFor(n,{readonly:l&&!!l.ck||i.readonly||o.deleted||!1,disabled:l&&l.disabled||!1,labelBy:i.domId}))),!1!==i.escape&&(n=t.escapeHTML(""+n)),!0===i.sanitize&&(n=t.sanitizeHtml(""+n)),a.highlighter&&(n=a.highlighter(a.highlighterContext,n,i)),e.markup(n)):(n=o.agg||o.inserted||l&&(l.changed||l.error||l.warning)?"":d||a.showNullAs,e.content(n)),d&&e.markup("</a>")},_beginSetColumnItems:function(){this.reinitCallbacks=[]},_setColumnItemValue:function(t,e,i,s){let o,l=null,a=this.model.getValue(e,i);null!==a&&"object"==typeof a&&K(a,"d")&&(l=a.d,a=a.v),this.reinitCallbacks?(o=t.reinit(a,l),o&&this.reinitCallbacks.push(o)):t.setValue(a,l),s&&(s.fields&&s.fields[i]&&s.fields[i].disabled?t.disable():t.enable())},_endSetColumnItems:function(){const t=this.reinitCallbacks;if(t)for(let e=0;e<t.length;e++)t[e]();this.reinitCallbacks=null},_autoAddRecord:function(t){const e=this.model.insertNewRecord(null,t);this.model.getRecordMetadata(e).autoInserted=!0},_triggerBeginEditing:function(t,e){this.element.trigger("apexbeginrecordedit",[{model:this.model,record:t,recordId:e}])},_triggerEndEditing:function(t,e){this.element.trigger("apexendrecordedit",[{model:this.model,record:t,recordId:e}])},_updateHighlights:function(){let t=this.options,e=[],i="";for(const[i,s]of q(t.highlights))s.id=i,e.push(s);e.sort(((t,e)=>e.seq-t.seq));for(let t=0;t<e.length;t++){let s=e[t];s.cssClass||(s.cssClass=(s.row?"hlr_":"hlc_")+s.id),(s.color||s.background)&&(s.row?i+="."+s.cssClass+" td":i+="td."+s.cssClass,i+=" { ",s.color&&(i+="color: "+s.color+" !important; "),s.background&&(i+="background-color: "+s.background+" !important; "),i+="}\n")}!this.gridStyles$&&i&&(this.gridStyles$=l("<style></style>"),l("head").append(this.gridStyles$)),this.gridStyles$&&(this.gridStyles$=this.gridStyles$.text(i))},_findStateIcon:function(t){return this.stateIcons$.find(`[${F}='${t}']`)},_setOption:function(t,e){const s=this.options;this._super(t,e),"noDataMessage"===t?this.element.find(lt(h,s)+" > div > "+lt(d,s)).text(e):"noDataIcon"===t?this.element.find(lt(h,s)+" > "+lt(c,s)+" span").attr(H,"a-Icon "+e):"rowsPerPage"===t?(s.pagination.scroll&&!s.pagination.loadMore&&(i.warn("Ignoring rowsPerPage when scroll pagination."),s.rowsPerPage=null),s.rowsPerPage&&(this.pageSize=s.rowsPerPage)):"hideDeletedRows"===t?(this.element.toggleClass(ot(f,s),e),!0===e&&this._deletedRowsHidden(),this._updateStatus()):"scrollParentOverride"===t?s.hasSize?i.warn("Ignoring scrollParentOverride when hasSize is true."):this._updateScrollHandler():"applyTemplateOptions"===t&&(this.atOptions=l.extend(!0,{},s.applyTemplateOptions||{},{extraSubstitutions:{},placeholders:{}}))},_updateScrollHandler:function(t){let e=this.options,i=this.scrollParent$,s=e.scrollParentOverride;e.hasSize?(this.scrollParent$=t,this.scrollDelta=0):(this.scrollParent$=l(s||window),this.scrollDelta=this.element.offset().top-this._getStickyTop()),this.totalRenderedRecords=0,e.pagination.scroll&&!e.pagination.loadMore&&(i&&this._scrollHandler?i.off("scroll",this._scrollHandler):this._scrollHandler=()=>{this.element[0].clientWidth>0&&this._scrollPage()},this.scrollParent$.on("scroll",this._scrollHandler))},_removeScrollHandler:function(){this._scrollHandler&&(this.scrollParent$.off("scroll",this._scrollHandler),this._scrollHandler=null)},_scrollPage:function(){const t=this,e=this.scrollParent$.scrollTop();e!==this.lastScrollTop&&(this.lastScrollTop=e,this.scrollPageTimer||(this.scrollPageTimer=setTimeout((function(){if(!t.model)return;let e,i,s,o,a,n,r,h,d=null,c=!1,g=ht(t.model),f=t.scrollParent$[0]===window,p=t.avgRowHeight;if(t.scrollPageTimer=null,t.renderInProgress)return t.lastScrollTop=null,void t._scrollPage();if(o=t.scrollParent$.height(),a=0-o/2,o*=2,n=a+o,e=t._getDataContainer(),i=t.scrollParent$.scrollTop(),t.hasScrollFillers&&(d=e.find(u),!d.length&&g&&t._removeScrollHandler(),s=t.pageOffset,e[0]&&(h="TBODY"===e[0].nodeName),d.each((function(){const e=l(this),r=Q(this.style.height),d=Q(e.attr(D)),g=Q(e.attr(b));let u,m;if(!(d>g))return m=f?e.offset().top:e.position().top,(f||h||e.offsetParent().closest(t.scrollParent$).length>0)&&(m-=i),u=m+r,m<=n&&u>=a?(t.pageOffset=r<2*o||m>a?d:it(u<n?g:d+Math.ceil((a+o/2-m)*t._getRecordsPerRow()/p),t.pageSize),t.pageOffset!==s&&t._addPageOfRecords(),c=!0,nt(e)||rt(e,!0),!1):void 0}))),!(c||g&&t.hasScrollFillers)){let s=e.height();(f||e.offsetParent().closest(t.scrollParent$).length>0)&&(s+=f?e.offset().top:e.position().top),s-=i,s>0&&s<=1.5*o&&(r=t.model.getTotalRecords(),r<0||t.highWaterMark<r?(t.pageOffset=t.highWaterMark,t._addPageOfRecords()):(d&&0===d.length||!d&&r===t.totalRenderedRecords)&&t._removeScrollHandler())}}),300)))},_updateTotalRecords:function(){const t=this.options,e=this.footer$,i=this.pageSelector$,s=t.pagination,o=this.model.getTotalRecords(),a=this.model.getServerTotalRecords(),n=ht(this.model);let r,h,d,c,g,f,p=null,u=null;function m(e){return 1===e&&t.entityTitleSingular?et("TOTAL_ENTITY_SINGULAR",t.entityTitleSingular):e>1&&t.entityTitlePlural?et("TOTAL_ENTITY_PLURAL",a,t.entityTitlePlural):tt("TOTAL_PAGES",a)}if(n&&this._updateStatus(),o>=0&&(p=Math.ceil(o/this.pageSize),u=Math.floor(this.pageOffset/this.pageSize)),null!==this.lastScrollLeft&&(this.scrollParent$.scrollLeft(this.lastScrollLeft),this.scrollParent$.scrollTop(this.lastScrollTop),this.lastScrollLeft=null,this.lastScrollTop=null),this.onLastPage=!1,0===this.pageCount&&0===this.pageOffset?(d="",this.onLastPage=!0,e.find(j).attr(L,!0),e.find(w).attr(I,V)):(e.find(j).attr(L,!1),e.find(w).removeAttr(I),this.element.find(".js-load").attr(L,!1),0===this.pageOffset&&e.find(".js-pg-prev,.js-pg-first").attr(L,!0),o>0&&u===p-1&&(this.onLastPage=!0,e.find(".js-pg-next,.js-pg-last").attr(L,!0),this.element.find(".js-load").attr(L,!0)),s.loadMore&&s.hideSinglePage&&this.element.find(".js-load").toggle(1!==p),d=s.scroll&&s.virtual&&!s.loadMore&&n?m(a):n?s.hideSinglePage&&1===p?m(a):tt("PAGE_RANGE_XYZ",this.pageFirstOffset,this.pageLastOffset,a):tt("PAGE_RANGE_XY",this.pageFirstOffset,this.pageLastOffset)),document.activeElement&&document.activeElement.disabled&&l(document.activeElement).hasClass("js-load")&&this.focus(),this.pageRange$&&this.pageRange$.text(d),p>0){if(s.showPageLinks){if(g=`${o}_${this.pageSize}_${u}`,this.pageKey!==g){f=`<li class="${ot("pageSelector-item",t)}">&hellip;</li>`,this.pageKey=g,c=`<ul class="${ot("pageSelector-list",t)}">`,r=u-Math.floor(s.maxLinks/2),r<0&&(r=0),h=r+s.maxLinks,h>=p&&(h=p,r=h-s.maxLinks,r<0&&(r=0)),r>0&&(c+=f);for(let e=r;e<h;e++)c+=`<li class="${ot("pageSelector-item",t)}" ${E}='${e}'><button class="${ot("pageButton",t)}" type='button'>${e+1}</button></li>`;h<p&&(c+=f),c+="</ul>",i.html(c)}i.find(R).removeClass(_).removeAttr(C).attr(k),i.find(`[${E}='${u}']`).addClass(_).attr(C,"page").attr(k,this.element[0].id)}else if(s.showPageSelector){if(g=`${o}_${this.pageSize}`,this.pageKey!==g){this.pageKey=g,c=`<select class="${ot("pageSelectlist",t)}" size='1' aria-label='${J("PAGE_SELECTION")}' aria-controls='${this.element[0].id}'>`;for(let t=0;t<p;t++)c+=`<option value='${t}'>${tt("SELECT_PAGE_N",t+1)}</option>`;c+="</select>",i.html(c)}i.children("select").val(u)}}else i.empty(),this.pageKey=null;s.hideSinglePage&&!s.scroll&&(e.find(j).add(i)[1===p?"hide":"show"](),e.find(w)[n?"show":"hide"]()),e[this.noData&&t.hideEmptyFooter?"hide":"show"]()},_updateAvgRowHeight:function(){let t;if(this.options.fixedRowHeight)t=this._getFixedRecordHeight();else{let e,i=this._getRecordsPerRow(),s=Math.ceil(this.totalRenderedRecords/i);s<=0?t=this.avgRowHeight||this._getFixedRecordHeight():(e=this._getDataContainer().height(),this._getDataContainer().find(u).each((function(){e-=l(this).height()})),t=e/s)}t<=0&&(t=43),this.avgRowHeight=t},_getStickyTop:function(){let t=this.options.stickyTop;return"function"==typeof t?t():0},_getHeaderHeight:function(){return 0},_getRecordsPerRow:function(){return 1},_getDataRenderContext:function(){return t.htmlBuilder()},_selectedCount:function(){return 0},_selectedStatusMessage:function(t){const e=this.options;return e.entityTitlePlural&&e.entityTitleSingular?et("SELECTED_ENTITY_COUNT",t,1===t?e.entityTitleSingular:e.entityTitlePlural):s.formatMessage(e.selectionStatusMessageKey,t)},_deletedRowsHidden:function(){},_deletedCount:function(){return 0},_hasControlBreaks:function(){return!1},_elementsFromRecordIds:function(){return[]},_renderFillerRecord:function(){},_insertFiller:function(){return l()},_insertData:function(t,e,i){this._trigger(U,null,{offset:e,count:i})},_controlBreakLabel:function(){return{}},_renderBreakRecord:function(t,e,i){t.markup("<h3>").content(i.label).markup("</h3>")},_renderRecord:function(){},_removeRecord:function(){},_insertRecord:function(){return l()},_afterInsert:function(){},_identityChanged:function(){},_replaceRecord:function(){},_updateRecordField:function(){},_removeFocus:function(){},_updateRecordState:function(){}}),l.apex.tableModelViewBase.clearColumnItemCache=function(t){if(t)for(const[e,i]of Z.entries())i.element$.parent()[0]===t&&Z.delete(e);else Z.clear()}}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.jQuery);
!function(e,t,i,s,o,l){"use strict";const n="is-selected",a=":visible",r="data-id",c="data-rownum",d="class",h="aria-disabled",u="disabled",p=Object.entries,g=e.applyTemplate,m=e=>parseInt(e,10);function f(t,i){return"."+function(t,i){const s=i.cssClassPrefix||"a-GV";return e.escapeHTMLAttr(s+"-"+t)}(t,i)}const _="a-TMV",S=_+"--variableHeight",C="a-TMV-w-scroll",T="."+C,R="a-TMV-hdr",$="."+R,A="is-disabled",E="."+A,I="selectionChange",{NAV_NONE:L}=apex.widget.ListViewSelection.NAV_MODES,P=l.ui.keyCode,w=/^\s*<\w+[^>]*>/,b=/<([^ <>]*)/;function O(e){e.APEX$ROW_STATE_CLASSES=e.APEX$AGG=e.APEX$AGG_TOTAL=e.APEX$ROW_URL=e.APEX$ROW_ID=e.APEX$ROW_INDEX=e.APEX$VALIDATION_MESSAGE=null}l.widget("apex.tableModelView",l.apex.tableModelViewBase,{widgetEventPrefix:"tableModelView",options:{headerTemplate:"",beforeTemplate:"<ul>",bodyTemplate:"",getDataObjectCallback:"",preRendered:!1,recordTemplate:"",controlBreakTemplate:"",aggregateTemplate:"",afterTemplate:"</ul>",syncHeaderHScroll:!1,collectionClasses:null,iconClassColumn:null,imageURLColumn:null,imageAttributes:null,labelColumn:null,linkTarget:!1,linkTargetColumn:null,linkAttributes:null,useIconList:!1,iconListOptions:{},itemNavigationMode:L,selectionFollowsFocus:!0,multiple:!1,selectAll:!1,selectAllId:null,allowSelectHidden:!1,itemSelector:null,accLabelColumn:null,constrainNavigation:!0,allowCopy:!0,clipboardValue:null,selectionStateItem:null,selectionChange:null,currentItemChange:null,pageChange:null},_create:function(){const e=this.options,t=this.element;i.info(`TableModelView '${t[0].id}' created. Model: ${e.modelName}`),e.preRendered&&(this._preRendered=!0),t.addClass(_),e.fixedRowHeight||t.addClass(S),e.recordTemplate||e.itemSelector||(e.itemSelector=".a-TMV-item"),this._sel=new apex.widget.ListViewSelection(this.element,{itemNavigationMode:e.itemNavigationMode,selectionFollowsFocus:e.selectionFollowsFocus,multiple:e.multiple,allowSelectAll:e.selectAll,selectAllId:e.selectAllId,allowSelectHidden:e.allowSelectHidden,itemSelector:e.itemSelector,constrainNavigation:e.constrainNavigation,selectionStateItem:e.selectionStateItem,persistSelection:e.persistSelection,itemsAreServerRendered:e._isTemplateReport||!1,allowCopy:e.allowCopy,clipboardValue:e.clipboardValue,dataTransferFormats:e.dataTransferFormats},{isValid:()=>this.element.hasClass(_),getContainer:()=>this._getDataContainer(),getModel:()=>this.model,getValuesForItems:e=>this.getRecords(e),renderItem:(e,t,i,s,o)=>{this._renderRecord(e,t,i,s,o)},selectionChanged:e=>{this._trigger(I,e)},currentItemChanged:()=>{this._trigger("currentItemChange")},updateStatus:()=>{this._updateStatus()},getPagination:()=>e.pagination,keyboardIgnoreSelector:()=>".a-GV-footer, .a-TMV-hdr",firstPage:()=>{this.firstPage()},lastPage:()=>{this.lastPage()},waitForPageChange:()=>new Promise((e=>{this.element.one("tablemodelviewpagechange",(()=>{e()}))}))}),e.itemNavigationMode=this._sel.itemNavigationMode,e.persistSelection=this._sel.persistSelection,this._enforceOptionConstraints(),this._super(),this.recordHeight=null,this.recPerRow=null,this._initModel(e.modelName),this._initRecordTemplate(),this._on(this._eventHandlers),this._sel.initialize(),this.refresh(),e.disabled&&this._setOption(u,e.disabled)},_eventHandlers:{keydown:function(e){const t=this.options,i=e.which;if(!e.isDefaultPrevented()&&t.useIconList){let s=this.getIconList().options;if(!s.navigation&&s.noNavKeyContent&&l(e.target).closest(s.noNavKeyContent).length)return;if(i!==P.DOWN&&i!==this.getIconList().forwardKey||!t.pagination.loadMore)(i===P.UP||i===this.getIconList().backwardKey)&&t.pagination.loadMore&&l(e.target).hasClass("js-load")&&(this.getIconList().focus(),e.preventDefault());else{let t=this.element.find(".js-load");if(t[0]){if(t[0].disabled)return;t.trigger("focus"),e.preventDefault()}}t.constrainNavigation&&[P.DOWN,P.UP,P.LEFT,P.RIGHT,P.PAGE_UP,P.PAGE_DOWN].includes(i)&&e.preventDefault()}},resize:function(e){e.target===this.element[0]&&(this.resize(),e.stopPropagation())}},_destroy:function(){const e=this.element;this._tableModelViewDestroy(),e.removeClass(_+" "+A).empty(),this._sel.destroy(),this._sel=null,i.info(`TableModelView '${e[0].id}' destroyed. Model: ${this.options.modelName}`),this.data$=null,this._initModel(null)},_setOption:function(e,t){const s=this.options;if(i.info(`TableModelView '${this.element[0].id}' set option '${e}' to: ${t}`),"iconListOptions"===e)throw new Error(`TableModelView '${e}' cannot be set. Set options directly on the iconList widget`);if("allowCopy"===e)throw new Error(`TableModelView '${e}' cannot be set`);if(["itemNavigationMode","selectionFollowsFocus","multiple","selectAll","selectAllId","allowSelectHidden","itemSelector","constrainNavigation","dataTransferFormats","clipboardValue","persistSelection","selectionStateItem",u].includes(e)){let i="selectAll"===e?"allowSelectAll":e;this._sel[i]=t,t=this._sel[i]}if(this._super(e,t),this._enforceOptionConstraints(),e===u){if(this.element.toggleClass(A,t),s.useIconList)return this.getIconList().option(e,t);t&&this.resize()}else"modelName"===e?(this._initModel(t),this.refresh(!1)):"highlights"===e?this._updateHighlights():"hideEmptyFooter"===e?this._updateTotalRecords():"fixedRowHeight"===e?(this.element.toggleClass(S,!t),this.refresh()):["beforeTemplate","recordTemplate","afterTemplate","collectionClasses","iconClassColumn","imageURLColumn","imageAttributes","labelColumn","linkTarget","linkTargetColumn","linkAttributes","bodyTemplate","entityTitleSingular","entityTitlePlural","multiple","itemNavigationMode"].includes(e)?(this.options.labelColumn&&(this.options.recordTemplate=null),this._initRecordTemplate(),this.refresh()):["footer","useIconList","pagination","rowsPerPage"].includes(e)&&this.refresh()},_enforceOptionConstraints:function(){const e=this.options;e.useIconList&&this._sel.supportsNavigation()&&(i.warn("Forced itemNavigationMode to none when useIconList is true"),e.itemNavigationMode=L,this._sel.itemNavigationMode=L),this._sel.supportsNavigation()&&!e.itemSelector&&(i.warn("Forced itemNavigationMode to none because itemSelector not defined"),e.itemNavigationMode=L,this._sel.itemNavigationMode=L),!this._sel.supportsSelection()&&e.persistSelection&&(i.warn("Forced persistSelection to false when itemNavigationMode is not selection"),e.persistSelection=!1,this._sel.persistSelection=!1)},refresh:function(e){const t=this.options,i=this,s=this.element;let o=!1;if(!0!==e&&(o=this._paginationHasFocus()),void 0===e&&(e=l(document.activeElement).closest(s).length>0),!this._refreshCheckIfVisible())return;let n=this.modelChanged;this.modelChanged=!1,this._sel.saveState(),!t.hasSize&&this.data$&&s.css("min-height",s.height()+"px"),t._isTemplateReport?this._refreshPagination(s):this._refreshPagination(s.find(T)),this._initView(),this._updateStatus(),this.resize(),this._preRendered&&!this.model._data.length||this._addPageOfRecords((function(){i.noData&&t.bodyTemplate&&i._initView(!0),o&&(i._restorePaginationFocus(o),e=!1),t.hasSize||s.css("min-height",""),i._sel.restoreState(n),i._updateHeaderFooter(s.find($)),e&&i.focus()}),!0),this._preRendered&&delete this._preRendered},resize:function(){const e=this.element,t=this.options,i=e.height(),s=e.children().first(),o=e.find(T);let l,n;null!==e[0].offsetParent&&(s.length&&!this.pendingRefresh?(l=e.width(),t._isTemplateReport||o.width(l),this.recordHeight=null,this.recPerRow=null,t.hasSize&&(n=i-this._footerHeight(),s.height(n),o.height(n-(e.find($).height()||0))),t.useIconList&&this.data$.iconList("resize"),this._initPageSize(),this._updateHeaderFooter(e.find($))):this.refresh())},focus:function(){const e=this.getIconList();e?e.focus():this._sel.focus()},getCurrentItem:function(){return this._sel.getCurrentItem()},setCurrentItem:function(e,t){this._sel.setCurrentItem(e,t)},getCurrentItemValue:function(){let e=this.getCurrentItem();if(e){let t=this.getRecords(e)[0];return this.model.getRecordId(t)}return null},setCurrentItemValue:function(t,i){let s=this._getDataContainer().find(`[${r}="${e.escapeCSS(t)}"]`);this.setCurrentItem(s,i)},getSelection:function(){const e=this.options,t=this.getIconList();return e.useIconList?t?t.getSelection():l():this._sel.getSelection()},setSelection:function(e,t,i){const s=this.getIconList();s?s.setSelection(e,t,i):this._sel.setSelection(e,t,i)},selectAll:function(e,t){this.options.useIconList||this._sel.selectAll(e,t)},getRecords:function(e){let t=this.model,i=[];return e.each((function(){let e,s=l(this).attr(r);s&&(e=t.getRecord(s),e&&i.push(e))})),i},getSelectedRecords:function(){if(this.data$){if(this.options.useIconList)return this.getRecords(this.getSelection());if(this._sel.supportsSelection())return this._sel.getSelectedValues()}return null},getSelectedValues:function(){const e=this.getSelectedRecords();return e?e.map((e=>this.model.getRecordId(e))):null},setSelectedRecords:function(e,t,i){const s=this.options,o=this.data$;if(!o||this.renderInProgress)return-1;if(s.useIconList){let n=[],a=0,c=e.length,d=new Set;!s.multiple&&c>1&&(c=1);for(let t=0;t<c;t++)d.add(this.model.getRecordId(e[t]));return o.children().each((function(){let e=l(this).attr(r);d.has(e)&&(d.delete(e),n.push(this),a+=1)})),this.setSelection(l(n),t,i),a}return this._sel.setSelectedValues(e,t,i)},setSelectedValues:function(e,t,i){let s=[];return e.forEach((e=>{const t=this.model.getRecord(e);t&&s.push(t)})),this.setSelectedRecords(s,t,i)},getIconList:function(){return this.options.useIconList&&this.data$?this.data$.data("apex-iconList"):null},_initRecordTemplate:function(){const e=this.options;if(!e.recordTemplate){let t,i,s;if(e.collectionClasses||(e.collectionClasses="a-TMV-defaultIconView"),!e.labelColumn)throw new Error("Option recordTemplate or labelColumn is required");e.beforeTemplate="<ul>",e.afterTemplate="</ul>",t=`<li ${r}='&APEX$ROW_ID.' ${c}='&APEX$ROW_INDEX.' class='a-TMV-item &APEX$ROW_STATE_CLASSES.'>`,e.linkTarget||e.linkTargetColumn?(s=e.linkTargetColumn?e.linkTargetColumn:"APEX$ROW_URL",t+=`<a href='&${s}.' class='a-IconList-content' ${e.linkAttributes?e.linkAttributes:""}>`,i="</a>"):(t+="<span class='a-IconList-content'>",i="</span>"),this._sel.supportsSelection()&&(t+="<div class='a-IconList-selection'>#APEX$SELECTOR#</span>"),(e.iconClassColumn||e.imageURLColumn)&&(t+="<span class='a-IconList-icon'>",e.iconClassColumn?t+=`<span class='&${e.iconClassColumn}.'></span>`:t+=`<img src='&${e.imageURLColumn}.' ${e.imageAttributes?e.imageAttributes:""}/>`,t+="</span>"),t+=`<span class='a-IconList-label'>&${e.labelColumn}.</span>${i}</li>`,e.recordTemplate=t}let t=this.atOptions;t.model=this.model,t.record=null,O(t.extraSubstitutions),w.exec(g(e.recordTemplate,t))||e.bodyTemplate||(g(e.beforeTemplate,t).toLowerCase().match(/<ul|<ol/)?e.recordTemplate=`<li>${e.recordTemplate}</li>`:e.recordTemplate=`<div>${e.recordTemplate}</div>`)},_initView:function(t=!1){const i=this,s=this.element,o=this.options,n="scroll.tmvss",a=this._getDataRenderContext(),r=this.atOptions,c=r.extraSubstitutions;let h,u,m,_,S=0,A=0,E=null;function L(){S!==A&&(m[0].scrollLeft=S=A,_[0].scrollLeft=S,u.css("left",S)),E=null}r.model=this.model,r.record=null,O(c),this.recordElement="div",h=b.exec(g(o.recordTemplate,r)),h&&h.length>1&&(this.recordElement=h[1].toLowerCase()),o._isTemplateReport||a.markup("<div").attr(d,"a-TMV-body").markup(">"),o.bodyTemplate||this._renderAltDataMessages(a);let P=[];for(const[e,t]of p(this.model.getOption("fields"))){let i=l.extend({fieldName:e},t);P.push(i)}if(P.sort(((e,t)=>e.seq-t.seq)),c.APEX$COLUMNS=P,o.headerTemplate&&!this._preRendered&&(r.placeholders.APEX$HAS_SELECTOR=this._sel.supportsSelection()?"Y":"N",r.placeholders.APEX$HAS_SELECT_ALL=this._sel.supportsSelection()&&o.multiple&&o.selectAll?"Y":"N",r.placeholders.APEX$SELECTOR="",a.markup(`<div class='${R}'>${g(o.headerTemplate,r)}</div>`)),o.firstDisplayedRow>0&&(this.pageOffset=o.firstDisplayedRow,delete o.firstDisplayedRow,this.pageOffset>0&&o.lazyLoading&&(this.model._data.length=1)),this._preRendered)s.find(f("footer",o)).remove(),this._renderLoadMore(a),this._renderFooter(a),s.append(a.toString());else{o._isTemplateReport||a.markup("<div").attr(d,C).markup(" tabindex='-1'>");let e="";o.getDataObjectCallback?this.data$=o.getDataObjectCallback(s):e+=`<${this.recordElement} class='js-data-placeholder' style='display:none;'></${this.recordElement}>`,o._isTemplateReport&&this.data$&&this.data$.length&&(e+=this.data$.html()),o.bodyTemplate?(r.placeholders.APEX$HAS_MESSAGE=t?"T":"",r.placeholders.APEX$MESSAGE=o.noDataMessage,r.placeholders.APEX$MESSAGE_ICON=o.noDataIcon,r.placeholders.APEX$COMPONENT_CSS_CLASSES=o.componentCssClasses||"",r.placeholders.APEX$ROWS=e,a.markup(g(o.bodyTemplate,r))):(r.placeholders.APEX$HAS_SELECTOR=this._sel.supportsSelection()?"Y":"N",r.placeholders.APEX$SELECTOR="",a.markup(g(o.beforeTemplate,r)).markup(e).markup(g(o.afterTemplate,r)),this._renderLoadMore(a)),o._isTemplateReport||a.markup("</div></div>"),t||(this.footer$&&this.footer$.prop("outerHTML")?a.markup(this.footer$.prop("outerHTML")):this._renderFooter(a)),s.html(a.toString())}if(o.getDataObjectCallback)this.data$=o.getDataObjectCallback(s);else{const e=s.find(".js-data-placeholder");this.data$=e.parent(),e.remove()}this.data$.addClass(o.collectionClasses||""),o.headerTemplate&&this._sel.selectAllId&&s.find("#"+this._sel.selectAllId)[0]&&(this._sel.selectAllId=this._sel.selectAllId),this._sel.contentChanged(),this.selectorPlaceholder=this._sel.supportsSelection()?this._sel.getPreferredSelectorControl():"",o.useIconList&&(this.data$.iconList(o.iconListOptions),this.data$.on("iconlistselectionchange",(function(e){i._updateStatus(),i._trigger(I,e)}))),_=o._isTemplateReport?s:s.find(T),m=s.find($),this._initPagination(m,_),o.headerTemplate&&o.syncHeaderHScroll&&(u=this.data$.find(f("loadMoreButton",o)),_.on(n,(function(){A=this.scrollLeft,E||(E=e.invokeAfterPaint(L))})),m.on(n,(function(){A=this.scrollLeft,E||(E=e.invokeAfterPaint(L))})))},_initRecordMetrics:function(){const e=this.atOptions;let t,i,s=0,o=this.options;if(O(this.atOptions.extraSubstitutions),e.record=null,this.recPerRow=1,t=this.data$.children().filter(a).first(),e.placeholders.APEX$SELECTOR=this._sel.getPreferredSelectorControl(),!t.length){let s,n="";for(s=0;s<20;s++)e.placeholders.APEX$ROW_IDENTIFICATION=`data-id="${s}" data-rownum="${s}"`,n+=g(o.recordTemplate,e);i=l(n),t=this.data$.append(i).children().filter(a).first(),o.useIconList&&this.getIconList().refresh()}if(o.useIconList)this.recPerRow=this.getIconList().getColumns();else{let e=t,i=e.length>0?Math.trunc(e.offset().top):0,o=i,l=0;for(;o===i&&e[0];)l+=1,e=e.next(),e[0]&&(o=Math.trunc(e.offset().top));this.recPerRow=l,s=o-i}this.recPerRow<1&&(this.recPerRow=1),0===s&&(s=t.outerHeight(!0),"grid"===this.data$.css("display")&&(s+=m(this.data$.css("grid-row-gap")))),this.recordHeight=s||43,i&&i.remove()},_getHeaderHeight:function(){return this.element.find($).outerHeight()},_getFixedRecordHeight:function(){return this.recordHeight||this._initRecordMetrics(),this.recordHeight},_getRecordsPerRow:function(){return this.recPerRow||this._initRecordMetrics(),this.recPerRow},_getDataContainer:function(){return this.data$},_checkSelectionChange:function(e){this.options.useIconList||this._sel.checkSelectionChange(e)},_selectedCount:function(){return this.options.useIconList?this.getIconList().getSelection().length:this._sel.supportsSelection()?this._sel.getSelectedCount():0},_deletedRowsHidden:function(){},_hasControlBreaks:function(){return null!=this.options.controlBreakTemplate},_elementsFromRecordIds:function(t){let i=[];for(let s=0;s<t.length;s++){let o=this.data$[0].querySelector(`[${r}="${e.escapeCSS(t[s])}"]`);o&&i.push(l(o))}return i},_renderFillerRecord:function(e,t){e.markup(`<${this.recordElement} aria-hidden="true" class="${t}"></${this.recordElement}>`)},_insertFiller:function(e,t){let i=l(e.toString());return t?t.before(i):this.data$.html(i),this._sel.contentChanged(),i},_insertData:function(e,t,i,s,o){const n=this.options;let a=l(e.toString());if(s?s[o](a):this.data$.append(a),a.find(E).add(a.filter(E)).attr(h,"true"),this._sel.contentChanged(a),n.useIconList){let e=this.element.find(T),t=e.scrollTop();this.getIconList().refresh(),e.scrollTop(t)}this.atOptions.clearItemCache=!0,this._super(e,t,i,s,o)},_controlBreakLabel:function(e){return{record:e}},_renderBreakRecord:function(e,t,i,s){const o=this.options;let l,n=this.atOptions,a=n.extraSubstitutions;O(a),n.model=this.model,n.record=i.record,a.APEX$ROW_ID="",a.APEX$ROW_INDEX=null!=s?""+(s+1):"",this.atOptions.placeholders.APEX$ROW_IDENTIFICATION=`data-rownum="${a.APEX$ROW_INDEX}"`,n.placeholders.APEX$SELECTOR="",l=g(this.options.controlBreakTemplate,n),o.highlighter&&(l=o.highlighter(o.highlighterContext,l)),e.markup(l),this.atOptions.clearItemCache=!1},_renderRecord:function(e,t,i,o,l){const a=this.options,r=this.atOptions,c=r.extraSubstitutions;let d,h,u=a.recordTemplate,p="",m="";if(O(c),l.agg){if(!a.aggregateTemplate)return;u=a.aggregateTemplate,c.APEX$AGG=l.agg,c.APEX$AGG_TOTAL=l.grandTotal?"Y":""}else l.url&&(c.APEX$ROW_URL=l.url),l.hidden&&(m+=" u-hidden"),this.model.isDisabled(t,l)&&(m+=" "+A),l.sel&&(m+=" "+n),l.deleted?m+=" is-deleted":(l.inserted?m+=" is-inserted":l.updated&&(m+=" is-updated"),l.error?m+=" is-error":l.warning&&(m+=" is-warning"),l.highlight&&(d=a.highlights[l.highlight],d&&d.cssClass?m+=" "+d.cssClass:m+=" "+l.highlight),l.message&&(c.APEX$VALIDATION_MESSAGE=l.message)),m&&(c.APEX$ROW_STATE_CLASSES=m);c.APEX$ROW_ID=""+o,c.APEX$ROW_INDEX=""+(i+1),r.placeholders.APEX$ROW_IDENTIFICATION=`data-id='${c.APEX$ROW_ID}' data-rownum="${c.APEX$ROW_INDEX}"`,p=a.accLabelColumn?s.formatMessage("APEX.TMV.SELECTOR_LABEL_1",this.model.getValue(t,a.accLabelColumn)):s.getMessage("APEX.TMV.SELECTOR_LABEL"),r.placeholders.APEX$SELECTOR=this.selectorPlaceholder.replaceAll("%0",p),r.model=this.model,r.record=t,h=g(u,r),a.highlighter&&!l.agg&&(h=a.highlighter(a.highlighterContext,h)),e.markup(h),this.atOptions.clearItemCache=!1},_removeRecord:function(e){e.remove(),this._sel.contentChanged()},_insertRecord:function(t,i,s,o,n){const a=e.htmlBuilder();this._renderRecord(a,i,null,s,o),this.atOptions.clearItemCache=!0;let r=l(a.toString());return"after"===n&&t?t.after(r):this.data$.prepend(r),r.find(E).add(r.filter(E)).attr(h,"true"),this.options.useIconList?this.getIconList().refresh():this._sel.contentChanged(r),r},_afterInsert:function(){},_identityChanged:function(e,t){const i=this._elementsFromRecordIds([e])[0];if(i){let s=this.model.getRecord(t),o=this.model.getRecordMetadata(t);this._replaceRecord(i,s,e,t,o)}},_replaceRecord:function(t,i,s,o,a){const r=this.options,d=e.htmlBuilder();let h,u=t.hasClass(n),p=t.attr(c)||null;null!==p&&(p=m(p)-1),u&&!r.persistSelection&&((a=l.extend({},a)).sel=!0),this._renderRecord(d,i,p,o,a),this.atOptions.clearItemCache=!0,h=l(d.toString()),r.itemSelector&&!h.is(r.itemSelector)&&(t=t.parent()),t.replaceWith(h),r.useIconList?(this.getIconList().refresh(),this.getIconList().setSelection(l("[data-id="+a.record.id+"]")),this.focus()):this._sel.contentChanged(h)},_removeFocus:function(){},_checkAllHidden:e.debounce((function(){const e=this.options.pagination;this.data$.children().is(":visible")?!e.scroll||e.loadMore||e.virtual||this.data$.height()<this.scrollParent$.height()&&this._addNextPage():(this.noData$.show(),this.data$.hide(),this.noData=!0)}),10),_updateRecordState:function(e,t,i,s,o){if("hidden"===o)return this.noData&&!s.hidden&&(this.noData$.hide(),this.data$.show(),this.noData=!1),e.toggleClass("u-hidden",s.hidden),void(this.noData||this._checkAllHidden());this._replaceRecord(e,i,t,t,s)}})}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.jQuery);